import{c as Vi,d as Gi,b as qi,H as Ki,I as Ct,J as Ji,f as Yi,a as Xi,P as it,K as je,L as Qi,o as Zi,s as eo,M as to,N as ro,O as no,Q as io,D as mt,w as Br,z as oo,R as qr,E as so}from"../../../promises.559e82d1.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Rn(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function ao(t){return Math.round(t/(t>768?1.6:.5))}async function co(t,e){const{model:r}=await t.send("DOM.getBoxModel",e).catch(()=>({model:void 0}));return r}async function uo(t,e,r,n){const i=await t.send("DOM.describeNode",r);return i.node.pseudoElements?.length?(await Promise.all(i.node.pseudoElements.map(async a=>{const c=await co(t,{backendNodeId:a.backendNodeId});if(!c)return;let u;if(e!==void 0||n){const f=(await t.send("DOM.resolveNode",{backendNodeId:a.backendNodeId,executionContextId:e})).object.objectId;f&&(u="pseudo_root@"+f,await t.send("Runtime.callFunctionOn",{functionDeclaration:function(p,m){//! javascript-obfuscator:disable
window[p]=m;//! javascript-obfuscator:enable
}.toString(),executionContextId:e,objectId:e?void 0:f,arguments:[{value:u},{objectId:f}],returnByValue:!0}))}return{pseudoType:a.pseudoType,key:u,...c}}))).filter(Boolean):[]}async function lo(t,e,r){if(r){const{node:i}=await t.send("DOM.describeNode",{nodeId:e}),a=await at(t,i.pseudoElements?.find(c=>c.pseudoType===r));a&&(e=a)}const{fonts:n}=await t.send("CSS.getPlatformFontsForNode",{nodeId:e});return[...n].sort((i,a)=>a.glyphCount-i.glyphCount).map(({familyName:i,postScriptName:a})=>({familyName:i,postScriptName:a}))}async function ho(t,e,r,n){if(n){const{node:i}=await t.send("DOM.describeNode",{nodeId:e}),a=await at(t,i.pseudoElements?.find(c=>c.pseudoType===n));a&&(e=a)}await t.send("CSS.forcePseudoState",{nodeId:e,forcedPseudoClasses:r})}async function at(t,e){if(!e)return;const{nodeId:r,backendNodeId:n}=e;if(r)return r;if(n){const{nodeIds:[i]}=await t.send("DOM.pushNodesByBackendIdsToFrontend",{backendNodeIds:[n]}).catch(()=>t.send("DOM.getDocument").then(()=>t.send("DOM.pushNodesByBackendIdsToFrontend",{backendNodeIds:[n]})));if(i)return i}}async function fo(t,e,r){const n=await t.send("DOM.describeNode",{...r,pierce:!0});if(!n.node.shadowRoots?.length)return;const a=(await t.send("DOM.resolveNode",{backendNodeId:n.node.shadowRoots[0].backendNodeId,executionContextId:e})).object.objectId;if(!a)return;const c="shadow_root@"+a;return await t.send("Runtime.callFunctionOn",{functionDeclaration:function(u,h){//! javascript-obfuscator:disable
window[u]=h;//! javascript-obfuscator:enable
}.toString(),executionContextId:e,arguments:[{value:c},{objectId:a}],returnByValue:!0}),c}async function po(t,e,r){const n=await t.send("DOM.describeNode",{...r,pierce:!0});if(!n.node.contentDocument)return;const a=(await t.send("DOM.resolveNode",{backendNodeId:n.node.contentDocument.backendNodeId,executionContextId:e})).object.objectId;if(!a)return;const c="shadow_root@"+a;return await t.send("Runtime.callFunctionOn",{functionDeclaration:function(u,h){//! javascript-obfuscator:disable
window[u]=h;//! javascript-obfuscator:enable
}.toString(),executionContextId:e,arguments:[{value:c},{objectId:a}],returnByValue:!0}),c}async function go(t,e,r,n){for(const i of new Set(e||[])){if(!i.src||i.src.startsWith("data:")||i.src in t)continue;if(n&&i.src in n){t[i.src]=n[i.src];continue}const a=await r(i);a?t[i.src]={...a,base64Encoded:!0}:console.error(`Unable to fetch font ${i.src}`)}}var ct=Xi(),le=new Map,Ve=new Map,kt=new Map,Nn=(t,e)=>(Ve.set(t,(Ve.get(t)||new Set).add(e)),()=>{const r=Ve.get(t);r?.delete(e)&&r?.size===0&&Ve.delete(t)}),On=(t,e)=>{kt.set(t,(kt.get(t)||new Set).add(e))},Be=t=>({withFingerprint:e=>{const r=i=>({and:()=>i}),n={aboutIncomingMessage:i=>{const a=le.get(t);return it.toExtensionContext(a.port,{status:"incoming",message:i}),r(n)},aboutSuccessfulDelivery:i=>{const a=le.get(t);return it.toExtensionContext(a.port,{status:"delivered",receipt:i}),r(n)},aboutMessageUndeliverability:(i,a)=>{const c=le.get(t);return c?.fingerprint===e&&it.toExtensionContext(c.port,{status:"undeliverable",resolvedDestination:i,message:a}),r(n)},whenDeliverableTo:i=>{const a=()=>{const c=le.get(t);if(c?.fingerprint===e&&le.has(i))return it.toExtensionContext(c.port,{status:"deliverable",deliverableTo:i}),!0};if(!a()){const c=Nn(i,a);On(e,c)}return r(n)},aboutSessionEnded:i=>{const a=le.get(t);return a?.fingerprint===e&&it.toExtensionContext(a.port,{status:"terminated",fingerprint:i}),r(n)}};return n}}),mo=Vi(),Dt=Gi("background",t=>{var e;if(t.origin.context==="background"&&["content-script","devtools "].includes(t.destination.context)&&!t.destination.tabId)throw new TypeError("When sending messages from background page, use @tabId syntax to target specific tab");const r=Ct(je(je({},t.origin),t.origin.context==="window"&&{context:"content-script"})),n=Ct(Qi(je(je({},t.destination),t.destination.context==="window"&&{context:"content-script"}),{tabId:t.destination.tabId||t.origin.tabId}));t.destination.tabId=null,t.destination.frameId=null;const i=()=>le.get(n),a=()=>le.get(r),c=()=>{var u;Be(n).withFingerprint(i().fingerprint).aboutIncomingMessage(t);const h={message:t,to:i().fingerprint,from:{endpointId:r,fingerprint:(u=a())==null?void 0:u.fingerprint}};t.messageType==="message"&&ct.add(h),t.messageType==="reply"&&ct.remove(t.messageID),a()&&Be(r).withFingerprint(a().fingerprint).aboutSuccessfulDelivery(h)};(e=i())!=null&&e.port?c():t.messageType==="message"&&(t.origin.context==="background"?Nn(n,c):a()&&Be(r).withFingerprint(a().fingerprint).aboutMessageUndeliverability(n,t).and().whenDeliverableTo(n))},t=>{const e=Ct(je(je({},t.origin),t.origin.context==="window"&&{context:"content-script"})),r=le.get(e),n={message:t,to:mo,from:{endpointId:e,fingerprint:r.fingerprint}};Be(e).withFingerprint(r.fingerprint).aboutSuccessfulDelivery(n)});qi.runtime.onConnect.addListener(t=>{var e;const r=Ki(t.name);if(!r)return;r.endpointName||(r.endpointName=Ct({context:"content-script",tabId:t.sender.tab.id,frameId:t.sender.frameId}));const{tabId:n,frameId:i}=Ji(r.endpointName);le.set(r.endpointName,{fingerprint:r.fingerprint,port:t}),(e=Ve.get(r.endpointName))==null||e.forEach(a=>a()),Ve.delete(r.endpointName),On(r.fingerprint,()=>{const a=ct.entries().filter(c=>c.to===r.fingerprint);ct.remove(a),a.forEach(c=>{c.from.endpointId==="background"?Dt.endTransaction(c.message.transactionId):Be(c.from.endpointId).withFingerprint(c.from.fingerprint).aboutSessionEnded(r.fingerprint)})}),t.onDisconnect.addListener(()=>{var a,c;((a=le.get(r.endpointName))==null?void 0:a.fingerprint)===r.fingerprint&&le.delete(r.endpointName),(c=kt.get(r.fingerprint))==null||c.forEach(u=>u()),kt.delete(r.fingerprint)}),t.onMessage.addListener(a=>{var c,u;if(a.type==="sync"){const h=[...le.values()].map(p=>p.fingerprint),f=a.pendingResponses.filter(p=>h.includes(p.to));ct.add(...f),a.pendingResponses.filter(p=>!h.includes(p.to)).forEach(p=>Be(r.endpointName).withFingerprint(r.fingerprint).aboutSessionEnded(p.to)),a.pendingDeliveries.forEach(p=>Be(r.endpointName).withFingerprint(r.fingerprint).whenDeliverableTo(p));return}a.type==="deliver"&&((u=(c=a.message)==null?void 0:c.origin)==null?void 0:u.context)&&(a.message.origin.tabId=n,a.message.origin.frameId=i,Dt.handleMessage(a.message))})});var{sendMessage:Pn,onMessage:wo}=Dt;Yi(Dt);const re=function(...t){return Zi(wo,...t)},ae=async function(...t){return eo(Pn,...t)};function yo(t,e,r){const n=Date.now(),i=u=>r?.({result:u,name:t,duration:Date.now()-n}),a=u=>(i({ret:u,failed:!1}),u),c=u=>{throw i({error:u,failed:!0}),u};try{const u=e();return to(u)?u.then(a).catch(c):a(u)}catch(u){return c(u)}}const Ye=(t,e,r)=>yo(t,e,n=>{console.log(`${t}${n.result.failed?" (errored)":""}: ${n.duration}ms`),r?.(n)}),vo=t=>{if(!t)return!1;try{return new URL(t),/^https?:\/\//.test(t)}catch{return!1}};function Io(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function zt(t,e,r,n){var i=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(i,zt.prototype),i.expected=e,i.found=r,i.location=n,i.name="SyntaxError",i}Io(zt,Error);function Xt(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,r+=r.repeat(e),t+r.slice(0,e))}zt.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r=null,n;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){r=t[n].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,a=this.location.source+":"+i.line+":"+i.column;if(r){var c=this.location.end,u=Xt("",i.line.toString().length," "),h=r[i.line-1],f=i.line===c.line?c.column:h.length+1,p=f-i.column||1;e+=`
 --> `+a+`
`+u+` |
`+i.line+" | "+h+`
`+u+" | "+Xt("",i.column-1," ")+Xt("",p,"^")}else e+=`
 at `+a}return e};zt.buildMessage=function(t,e){var r={literal:function(f){return'"'+i(f.text)+'"'},class:function(f){var p=f.parts.map(function(m){return Array.isArray(m)?a(m[0])+"-"+a(m[1]):a(m)});return"["+(f.inverted?"^":"")+p.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(f){return f.description}};function n(f){return f.charCodeAt(0).toString(16).toUpperCase()}function i(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+n(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+n(p)})}function a(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+n(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+n(p)})}function c(f){return r[f.type](f)}function u(f){var p=f.map(c),m,v;if(p.sort(),p.length>0){for(m=1,v=1;m<p.length;m++)p[m-1]!==p[m]&&(p[v]=p[m],v++);p.length=v}switch(p.length){case 1:return p[0];case 2:return p[0]+" or "+p[1];default:return p.slice(0,-1).join(", ")+", or "+p[p.length-1]}}function h(f){return f?'"'+i(f)+'"':"end of input"}return"Expected "+u(t)+" but "+h(e)+" found."};var Qt="(".charCodeAt(0),Zt=")".charCodeAt(0),Et="'".charCodeAt(0),er='"'.charCodeAt(0),tr="\\".charCodeAt(0),We="/".charCodeAt(0),rr=",".charCodeAt(0),nr=":".charCodeAt(0),At="*".charCodeAt(0),bo="u".charCodeAt(0),_o="U".charCodeAt(0),Eo="+".charCodeAt(0),Ao=/^[a-f0-9?-]+$/i,So=function(t){for(var e=[],r=t,n,i,a,c,u,h,f,p,m=0,v=r.charCodeAt(m),E=r.length,C=[{nodes:e}],D=0,T,L="",$="",W="";m<E;)if(v<=32){n=m;do n+=1,v=r.charCodeAt(n);while(v<=32);c=r.slice(m,n),a=e[e.length-1],v===Zt&&D?W=c:a&&a.type==="div"?(a.after=c,a.sourceEndIndex+=c.length):v===rr||v===nr||v===We&&r.charCodeAt(n+1)!==At&&(!T||T&&T.type==="function"&&T.value!=="calc")?$=c:e.push({type:"space",sourceIndex:m,sourceEndIndex:n,value:c}),m=n}else if(v===Et||v===er){n=m,i=v===Et?"'":'"',c={type:"string",sourceIndex:m,quote:i};do if(u=!1,n=r.indexOf(i,n+1),~n)for(h=n;r.charCodeAt(h-1)===tr;)h-=1,u=!u;else r+=i,n=r.length-1,c.unclosed=!0;while(u);c.value=r.slice(m+1,n),c.sourceEndIndex=c.unclosed?n:n+1,e.push(c),m=n+1,v=r.charCodeAt(m)}else if(v===We&&r.charCodeAt(m+1)===At)n=r.indexOf("*/",m),c={type:"comment",sourceIndex:m,sourceEndIndex:n+2},n===-1&&(c.unclosed=!0,n=r.length,c.sourceEndIndex=n),c.value=r.slice(m+2,n),e.push(c),m=n+2,v=r.charCodeAt(m);else if((v===We||v===At)&&T&&T.type==="function"&&T.value==="calc")c=r[m],e.push({type:"word",sourceIndex:m-$.length,sourceEndIndex:m+c.length,value:c}),m+=1,v=r.charCodeAt(m);else if(v===We||v===rr||v===nr)c=r[m],e.push({type:"div",sourceIndex:m-$.length,sourceEndIndex:m+c.length,value:c,before:$,after:""}),$="",m+=1,v=r.charCodeAt(m);else if(Qt===v){n=m;do n+=1,v=r.charCodeAt(n);while(v<=32);if(p=m,c={type:"function",sourceIndex:m-L.length,value:L,before:r.slice(p+1,n)},m=n,L==="url"&&v!==Et&&v!==er){n-=1;do if(u=!1,n=r.indexOf(")",n+1),~n)for(h=n;r.charCodeAt(h-1)===tr;)h-=1,u=!u;else r+=")",n=r.length-1,c.unclosed=!0;while(u);f=n;do f-=1,v=r.charCodeAt(f);while(v<=32);p<f?(m!==f+1?c.nodes=[{type:"word",sourceIndex:m,sourceEndIndex:f+1,value:r.slice(m,f+1)}]:c.nodes=[],c.unclosed&&f+1!==n?(c.after="",c.nodes.push({type:"space",sourceIndex:f+1,sourceEndIndex:n,value:r.slice(f+1,n)})):(c.after=r.slice(f+1,n),c.sourceEndIndex=n)):(c.after="",c.nodes=[]),m=n+1,c.sourceEndIndex=c.unclosed?n:m,v=r.charCodeAt(m),e.push(c)}else D+=1,c.after="",c.sourceEndIndex=m+1,e.push(c),C.push(c),e=c.nodes=[],T=c;L=""}else if(Zt===v&&D)m+=1,v=r.charCodeAt(m),T.after=W,T.sourceEndIndex+=W.length,W="",D-=1,C[C.length-1].sourceEndIndex=m,C.pop(),T=C[D],e=T.nodes;else{n=m;do v===tr&&(n+=1),n+=1,v=r.charCodeAt(n);while(n<E&&!(v<=32||v===Et||v===er||v===rr||v===nr||v===We||v===Qt||v===At&&T&&T.type==="function"&&T.value==="calc"||v===We&&T.type==="function"&&T.value==="calc"||v===Zt&&D));c=r.slice(m,n),Qt===v?L=c:(bo===c.charCodeAt(0)||_o===c.charCodeAt(0))&&Eo===c.charCodeAt(1)&&Ao.test(c.slice(2))?e.push({type:"unicode-range",sourceIndex:m,sourceEndIndex:n,value:c}):e.push({type:"word",sourceIndex:m,sourceEndIndex:n,value:c}),m=n}for(m=C.length-1;m;m-=1)C[m].unclosed=!0,C[m].sourceEndIndex=r.length;return C[0].nodes},Co=function t(e,r,n){var i,a,c,u;for(i=0,a=e.length;i<a;i+=1)c=e[i],n||(u=r(c,i,e)),u!==!1&&c.type==="function"&&Array.isArray(c.nodes)&&t(c.nodes,r,n),n&&r(c,i,e)};function Kr(t,e){var r=t.type,n=t.value,i,a;return e&&(a=e(t))!==void 0?a:r==="word"||r==="space"?n:r==="string"?(i=t.quote||"",i+n+(t.unclosed?"":i)):r==="comment"?"/*"+n+(t.unclosed?"":"*/"):r==="div"?(t.before||"")+n+(t.after||""):Array.isArray(t.nodes)?(i=Bn(t.nodes,e),r!=="function"?i:n+"("+(t.before||"")+i+(t.after||"")+(t.unclosed?"":")")):n}function Bn(t,e){var r,n;if(Array.isArray(t)){for(r="",n=t.length-1;~n;n-=1)r=Kr(t[n],e)+r;return r}return Kr(t,e)}var xo=Bn,ir,Jr;function To(){if(Jr)return ir;Jr=1;var t="-".charCodeAt(0),e="+".charCodeAt(0),r=".".charCodeAt(0),n="e".charCodeAt(0),i="E".charCodeAt(0);function a(c){var u=c.charCodeAt(0),h;if(u===e||u===t){if(h=c.charCodeAt(1),h>=48&&h<=57)return!0;var f=c.charCodeAt(2);return h===r&&f>=48&&f<=57}return u===r?(h=c.charCodeAt(1),h>=48&&h<=57):u>=48&&u<=57}return ir=function(c){var u=0,h=c.length,f,p,m;if(h===0||!a(c))return!1;for(f=c.charCodeAt(u),(f===e||f===t)&&u++;u<h&&(f=c.charCodeAt(u),!(f<48||f>57));)u+=1;if(f=c.charCodeAt(u),p=c.charCodeAt(u+1),f===r&&p>=48&&p<=57)for(u+=2;u<h&&(f=c.charCodeAt(u),!(f<48||f>57));)u+=1;if(f=c.charCodeAt(u),p=c.charCodeAt(u+1),m=c.charCodeAt(u+2),(f===n||f===i)&&(p>=48&&p<=57||(p===e||p===t)&&m>=48&&m<=57))for(u+=p===e||p===t?3:2;u<h&&(f=c.charCodeAt(u),!(f<48||f>57));)u+=1;return{number:c.slice(0,u),unit:c.slice(u)}},ir}var ko=So,Un=Co,Fn=xo;function De(t){return this instanceof De?(this.nodes=ko(t),this):new De(t)}De.prototype.toString=function(){return Array.isArray(this.nodes)?Fn(this.nodes):""};De.prototype.walk=function(t,e){return Un(this.nodes,t,e),this};De.unit=To();De.walk=Un;De.stringify=Fn;var Do=De;function Yr(t){return t.filter(e=>e.type!=="space")}function Ro(t){return No(t,",")}function No(t,e){const r=[];let n=0;for(let i=0;i<t.length;i++)t[i].type==="div"&&t[i].value===e&&(r.push(Yr(t.slice(n,i))),n=i+1);return r.push(Yr(t.slice(n))),r}const Ur=3e7;class Ie{def;stackCleaner=e=>e;static SHARED_SERVICE_URLS=["https://api.divriots.com","https://api-eu.divriots.com"];static serviceUrl;constructor(e){this.def=e}addDefault(e){if(this.def){if(this.def.properties){const{properties:r,...n}=e;Object.assign(this.def.properties,r),e=n}Object.assign(this.def,e)}else this.def={...e}}resetDefault(){this.def=void 0}transformOptions(e){if(!e)return;const{country:r,userAgent:n}=e,i={};return r&&(i.co=r),n&&(i.ua=n),i}async feature_test(e,r){if("feature"in r){console.error("`feature` is a reserved property for feature_test tracking.");return}return this.track("feature-test",{properties:{feature:e,...r}})}async exception(e,r,n){({}).FIREBASE_CONFIG&&console.error(`Analytics.exception(): ${e}`,r,n);const i={name:e};return n&&(i.details=typeof n=="string"?n:JSON.stringify(n)),this.track("exception",{error:r,properties:i})}catcher(e,r){return n=>{this.exception(e,n,r)}}unhandled(e,r){try{const n=r();return n&&typeof n=="object"&&"catch"in n?n.catch(this.catcher(e)):n}catch(n){this.exception(e,n)}}setStackCleaner(e){this.stackCleaner=e}async track(e,r={},n){const i={...this.def?.properties,...r.properties};if(r.error){const u=r.error;i.error_message=u.message||String(u),i.error_stack=this.stackCleaner(ro(u)),delete r.error}const a={event:e,version:{}.__FIGMA_PLUGIN_VERSION__,...this.def,...r,properties:i,options:this.transformOptions(n)};if(!a.product){console.error("Analytics.track(): `product` property is missing.");return}const c=async(u,h)=>{try{return await fetch(`${u}/pa`,{method:"POST",body:JSON.stringify(a)}),!0}catch(f){h&&console.error(`Analytics.track(): Unexpected error on event ${e}.`,f)}return!1};if(Ie.serviceUrl)await c(Ie.serviceUrl,!0);else{const u=[...Ie.SHARED_SERVICE_URLS];for(;u.length;){const h=u.shift();if(await c(h,!u.length)){Ie.serviceUrl=h;return}}Ie.serviceUrl||(Ie.serviceUrl=Ie.SHARED_SERVICE_URLS[0])}}}class Oo extends Ie{isInitialized=!1;constructor(){super({})}initialize(e){this.addDefault(e),this.isInitialized=!0}}const K=new Oo;async function Po(t,{frameId:e,url:r}){return t.send("Page.getResourceContent",{frameId:e,url:r}).catch(()=>({content:"",base64Encoded:!1}))}async function Bo({baseURI:t,frame:e,acceptLocalFiles:r,...n}){const i=Object.fromEntries(wr(t,e).filter(([a])=>Fo(a,r)&&!a.startsWith("data:")));return Mn({...n,urlWithMeta:i})}async function Mn({urlWithMeta:t,client:e,cache:r,ignoredUrls:n}){const i=new Map;for(const h of new Set(Object.values(t)))i.set(h,await e.getResourceTree(h));const a={},c=Object.entries(t).filter(([h,f])=>{if(n?.has(h))return!1;const p=Fr(i.get(f).frameTree,h);if(Uo(p))return console.debug("Ignoring asset",p),!1;const m=r?.[h];return m?(a[h]=m,!1):!0});return(await no(Array.from(c),10,async([h,f])=>{const p=i.get(f),m=p.frameTree.frame.id;let v=h.replace(/#.*/,"").endsWith(".svg"),E;try{E=await Mo(e,f,m,p,h)}catch(C){console.debug("Page.getResourceContent failed, falling back to fetch",h);try{E=await io(e.fetchAsset(f,h),3e4).then(D=>{if(D)return D;throw new Error("client.fetchAsset timeout")})}catch(D){K.exception("fetchAsset:gatherUrls",C,f),console.warn(`Fetch image (${h}) failed`,D),v=!1,E={content:"",mimeType:"",base64Encoded:!1}}}return v&&(E.mimeType="image/svg+xml"),[h,E]})).filter(([,h])=>!!h.content).filter(([,h])=>h.content.length<Ur).forEach(([h,f])=>a[h]=f),a}function Uo(t){return t?t.canceled||t.failed||!!t.contentSize&&t.contentSize>Ur:!1}function wr(t,e,r={type:"default"}){if(e.type!=="FRAME")return[];const n=[];e.$url&&n.push([e.$url,r]),e.hover&&n.push(...wr(t,e.hover,r)),r=e.$assetsMeta||r,e.children?.forEach(i=>n.push(...wr(e.tag==="body"?e.attr.baseURI:t,i,r)));for(const i of[e.styles.backgroundImage,e.styles.webkitMaskImage,e.styles.content])i&&i!=="none"&&i!=="normal"&&Ro(Do(i).nodes).forEach(([c])=>{if(c.type==="function"&&c.value==="url"){const u=c.nodes[0].value;u!==t&&n.push([u,r])}});return n}function Fo(t,e){return!!t&&(vo(t)||/^data:./.test(t)||/^blob:./.test(t)||!!e&&t.startsWith("file://"))}async function Mo(t,e,r,n,i){const a=await t.getResourceContent({meta:e,cdpFrameId:r,url:i});if(!a.content)throw new Error("no content from CDP");i=i.replace(/#.*/,"");const c=Fr(n.frameTree,i)?.mimeType||"";return{...a,mimeType:c}}function Fr(t,e){const{resources:r,childFrames:n}=t,i=r.find(a=>a.url===e);if(i)return i;for(const a of n||[]){const c=Fr(a,e);if(c)return c}}async function Lo(t,e,r){let n;const i=new AbortController;try{const a=setTimeout(()=>i.abort(),5e3);n=await e(t,{signal:i.signal}).finally(()=>clearTimeout(a))}catch{}if(n?.ok){const a=n.headers.get("content-length");return a&&parseInt(a)>Ur?(i.abort(),{content:"",mimeType:""}):{content:r(await n.arrayBuffer()),mimeType:n.headers.get("content-type")||""}}}var Ue={},jt={};jt.byteLength=jo;jt.toByteArray=Ho;jt.fromByteArray=qo;var pe=[],de=[],$o=typeof Uint8Array<"u"?Uint8Array:Array,or="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var He=0,zo=or.length;He<zo;++He)pe[He]=or[He],de[or.charCodeAt(He)]=He;de["-".charCodeAt(0)]=62;de["_".charCodeAt(0)]=63;function Ln(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function jo(t){var e=Ln(t),r=e[0],n=e[1];return(r+n)*3/4-n}function Wo(t,e,r){return(e+r)*3/4-r}function Ho(t){var e,r=Ln(t),n=r[0],i=r[1],a=new $o(Wo(t,n,i)),c=0,u=i>0?n-4:n,h;for(h=0;h<u;h+=4)e=de[t.charCodeAt(h)]<<18|de[t.charCodeAt(h+1)]<<12|de[t.charCodeAt(h+2)]<<6|de[t.charCodeAt(h+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=e&255;return i===2&&(e=de[t.charCodeAt(h)]<<2|de[t.charCodeAt(h+1)]>>4,a[c++]=e&255),i===1&&(e=de[t.charCodeAt(h)]<<10|de[t.charCodeAt(h+1)]<<4|de[t.charCodeAt(h+2)]>>2,a[c++]=e>>8&255,a[c++]=e&255),a}function Vo(t){return pe[t>>18&63]+pe[t>>12&63]+pe[t>>6&63]+pe[t&63]}function Go(t,e,r){for(var n,i=[],a=e;a<r;a+=3)n=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(t[a+2]&255),i.push(Vo(n));return i.join("")}function qo(t){for(var e,r=t.length,n=r%3,i=[],a=16383,c=0,u=r-n;c<u;c+=a)i.push(Go(t,c,c+a>u?u:c+a));return n===1?(e=t[r-1],i.push(pe[e>>2]+pe[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(pe[e>>10]+pe[e>>4&63]+pe[e<<2&63]+"=")),i.join("")}var Mr={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Mr.read=function(t,e,r,n,i){var a,c,u=i*8-n-1,h=(1<<u)-1,f=h>>1,p=-7,m=r?i-1:0,v=r?-1:1,E=t[e+m];for(m+=v,a=E&(1<<-p)-1,E>>=-p,p+=u;p>0;a=a*256+t[e+m],m+=v,p-=8);for(c=a&(1<<-p)-1,a>>=-p,p+=n;p>0;c=c*256+t[e+m],m+=v,p-=8);if(a===0)a=1-f;else{if(a===h)return c?NaN:(E?-1:1)*(1/0);c=c+Math.pow(2,n),a=a-f}return(E?-1:1)*c*Math.pow(2,a-n)};Mr.write=function(t,e,r,n,i,a){var c,u,h,f=a*8-i-1,p=(1<<f)-1,m=p>>1,v=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=n?0:a-1,C=n?1:-1,D=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,c=p):(c=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-c))<1&&(c--,h*=2),c+m>=1?e+=v/h:e+=v*Math.pow(2,1-m),e*h>=2&&(c++,h/=2),c+m>=p?(u=0,c=p):c+m>=1?(u=(e*h-1)*Math.pow(2,i),c=c+m):(u=e*Math.pow(2,m-1)*Math.pow(2,i),c=0));i>=8;t[r+E]=u&255,E+=C,u/=256,i-=8);for(c=c<<i|u,f+=i;f>0;t[r+E]=c&255,E+=C,c/=256,f-=8);t[r+E-C]|=D*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=jt,r=Mr,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=$,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i,u.TYPED_ARRAY_SUPPORT=a(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function a(){try{const l=new Uint8Array(1),o={foo:function(){return 42}};return Object.setPrototypeOf(o,Uint8Array.prototype),Object.setPrototypeOf(l,o),l.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(!!u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(!!u.isBuffer(this))return this.byteOffset}});function c(l){if(l>i)throw new RangeError('The value "'+l+'" is invalid for option "size"');const o=new Uint8Array(l);return Object.setPrototypeOf(o,u.prototype),o}function u(l,o,s){if(typeof l=="number"){if(typeof o=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(l)}return h(l,o,s)}u.poolSize=8192;function h(l,o,s){if(typeof l=="string")return v(l,o);if(ArrayBuffer.isView(l))return C(l);if(l==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l);if(fe(l,ArrayBuffer)||l&&fe(l.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(fe(l,SharedArrayBuffer)||l&&fe(l.buffer,SharedArrayBuffer)))return D(l,o,s);if(typeof l=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const d=l.valueOf&&l.valueOf();if(d!=null&&d!==l)return u.from(d,o,s);const g=T(l);if(g)return g;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof l[Symbol.toPrimitive]=="function")return u.from(l[Symbol.toPrimitive]("string"),o,s);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof l)}u.from=function(l,o,s){return h(l,o,s)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array);function f(l){if(typeof l!="number")throw new TypeError('"size" argument must be of type number');if(l<0)throw new RangeError('The value "'+l+'" is invalid for option "size"')}function p(l,o,s){return f(l),l<=0?c(l):o!==void 0?typeof s=="string"?c(l).fill(o,s):c(l).fill(o):c(l)}u.alloc=function(l,o,s){return p(l,o,s)};function m(l){return f(l),c(l<0?0:L(l)|0)}u.allocUnsafe=function(l){return m(l)},u.allocUnsafeSlow=function(l){return m(l)};function v(l,o){if((typeof o!="string"||o==="")&&(o="utf8"),!u.isEncoding(o))throw new TypeError("Unknown encoding: "+o);const s=W(l,o)|0;let d=c(s);const g=d.write(l,o);return g!==s&&(d=d.slice(0,g)),d}function E(l){const o=l.length<0?0:L(l.length)|0,s=c(o);for(let d=0;d<o;d+=1)s[d]=l[d]&255;return s}function C(l){if(fe(l,Uint8Array)){const o=new Uint8Array(l);return D(o.buffer,o.byteOffset,o.byteLength)}return E(l)}function D(l,o,s){if(o<0||l.byteLength<o)throw new RangeError('"offset" is outside of buffer bounds');if(l.byteLength<o+(s||0))throw new RangeError('"length" is outside of buffer bounds');let d;return o===void 0&&s===void 0?d=new Uint8Array(l):s===void 0?d=new Uint8Array(l,o):d=new Uint8Array(l,o,s),Object.setPrototypeOf(d,u.prototype),d}function T(l){if(u.isBuffer(l)){const o=L(l.length)|0,s=c(o);return s.length===0||l.copy(s,0,0,o),s}if(l.length!==void 0)return typeof l.length!="number"||Yt(l.length)?c(0):E(l);if(l.type==="Buffer"&&Array.isArray(l.data))return E(l.data)}function L(l){if(l>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return l|0}function $(l){return+l!=l&&(l=0),u.alloc(+l)}u.isBuffer=function(o){return o!=null&&o._isBuffer===!0&&o!==u.prototype},u.compare=function(o,s){if(fe(o,Uint8Array)&&(o=u.from(o,o.offset,o.byteLength)),fe(s,Uint8Array)&&(s=u.from(s,s.offset,s.byteLength)),!u.isBuffer(o)||!u.isBuffer(s))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(o===s)return 0;let d=o.length,g=s.length;for(let w=0,y=Math.min(d,g);w<y;++w)if(o[w]!==s[w]){d=o[w],g=s[w];break}return d<g?-1:g<d?1:0},u.isEncoding=function(o){switch(String(o).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(o,s){if(!Array.isArray(o))throw new TypeError('"list" argument must be an Array of Buffers');if(o.length===0)return u.alloc(0);let d;if(s===void 0)for(s=0,d=0;d<o.length;++d)s+=o[d].length;const g=u.allocUnsafe(s);let w=0;for(d=0;d<o.length;++d){let y=o[d];if(fe(y,Uint8Array))w+y.length>g.length?(u.isBuffer(y)||(y=u.from(y)),y.copy(g,w)):Uint8Array.prototype.set.call(g,y,w);else if(u.isBuffer(y))y.copy(g,w);else throw new TypeError('"list" argument must be an Array of Buffers');w+=y.length}return g};function W(l,o){if(u.isBuffer(l))return l.length;if(ArrayBuffer.isView(l)||fe(l,ArrayBuffer))return l.byteLength;if(typeof l!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof l);const s=l.length,d=arguments.length>2&&arguments[2]===!0;if(!d&&s===0)return 0;let g=!1;for(;;)switch(o){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return Jt(l).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s*2;case"hex":return s>>>1;case"base64":return Gr(l).length;default:if(g)return d?-1:Jt(l).length;o=(""+o).toLowerCase(),g=!0}}u.byteLength=W;function A(l,o,s){let d=!1;if((o===void 0||o<0)&&(o=0),o>this.length||((s===void 0||s>this.length)&&(s=this.length),s<=0)||(s>>>=0,o>>>=0,s<=o))return"";for(l||(l="utf8");;)switch(l){case"hex":return Z(this,o,s);case"utf8":case"utf-8":return R(this,o,s);case"ascii":return B(this,o,s);case"latin1":case"binary":return j(this,o,s);case"base64":return H(this,o,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ie(this,o,s);default:if(d)throw new TypeError("Unknown encoding: "+l);l=(l+"").toLowerCase(),d=!0}}u.prototype._isBuffer=!0;function S(l,o,s){const d=l[o];l[o]=l[s],l[s]=d}u.prototype.swap16=function(){const o=this.length;if(o%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let s=0;s<o;s+=2)S(this,s,s+1);return this},u.prototype.swap32=function(){const o=this.length;if(o%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let s=0;s<o;s+=4)S(this,s,s+3),S(this,s+1,s+2);return this},u.prototype.swap64=function(){const o=this.length;if(o%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let s=0;s<o;s+=8)S(this,s,s+7),S(this,s+1,s+6),S(this,s+2,s+5),S(this,s+3,s+4);return this},u.prototype.toString=function(){const o=this.length;return o===0?"":arguments.length===0?R(this,0,o):A.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(o){if(!u.isBuffer(o))throw new TypeError("Argument must be a Buffer");return this===o?!0:u.compare(this,o)===0},u.prototype.inspect=function(){let o="";const s=t.INSPECT_MAX_BYTES;return o=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(o+=" ... "),"<Buffer "+o+">"},n&&(u.prototype[n]=u.prototype.inspect),u.prototype.compare=function(o,s,d,g,w){if(fe(o,Uint8Array)&&(o=u.from(o,o.offset,o.byteLength)),!u.isBuffer(o))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof o);if(s===void 0&&(s=0),d===void 0&&(d=o?o.length:0),g===void 0&&(g=0),w===void 0&&(w=this.length),s<0||d>o.length||g<0||w>this.length)throw new RangeError("out of range index");if(g>=w&&s>=d)return 0;if(g>=w)return-1;if(s>=d)return 1;if(s>>>=0,d>>>=0,g>>>=0,w>>>=0,this===o)return 0;let y=w-g,P=d-s;const X=Math.min(y,P),Y=this.slice(g,w),Q=o.slice(s,d);for(let V=0;V<X;++V)if(Y[V]!==Q[V]){y=Y[V],P=Q[V];break}return y<P?-1:P<y?1:0};function _(l,o,s,d,g){if(l.length===0)return-1;if(typeof s=="string"?(d=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),s=+s,Yt(s)&&(s=g?0:l.length-1),s<0&&(s=l.length+s),s>=l.length){if(g)return-1;s=l.length-1}else if(s<0)if(g)s=0;else return-1;if(typeof o=="string"&&(o=u.from(o,d)),u.isBuffer(o))return o.length===0?-1:b(l,o,s,d,g);if(typeof o=="number")return o=o&255,typeof Uint8Array.prototype.indexOf=="function"?g?Uint8Array.prototype.indexOf.call(l,o,s):Uint8Array.prototype.lastIndexOf.call(l,o,s):b(l,[o],s,d,g);throw new TypeError("val must be string, number or Buffer")}function b(l,o,s,d,g){let w=1,y=l.length,P=o.length;if(d!==void 0&&(d=String(d).toLowerCase(),d==="ucs2"||d==="ucs-2"||d==="utf16le"||d==="utf-16le")){if(l.length<2||o.length<2)return-1;w=2,y/=2,P/=2,s/=2}function X(Q,V){return w===1?Q[V]:Q.readUInt16BE(V*w)}let Y;if(g){let Q=-1;for(Y=s;Y<y;Y++)if(X(l,Y)===X(o,Q===-1?0:Y-Q)){if(Q===-1&&(Q=Y),Y-Q+1===P)return Q*w}else Q!==-1&&(Y-=Y-Q),Q=-1}else for(s+P>y&&(s=y-P),Y=s;Y>=0;Y--){let Q=!0;for(let V=0;V<P;V++)if(X(l,Y+V)!==X(o,V)){Q=!1;break}if(Q)return Y}return-1}u.prototype.includes=function(o,s,d){return this.indexOf(o,s,d)!==-1},u.prototype.indexOf=function(o,s,d){return _(this,o,s,d,!0)},u.prototype.lastIndexOf=function(o,s,d){return _(this,o,s,d,!1)};function I(l,o,s,d){s=Number(s)||0;const g=l.length-s;d?(d=Number(d),d>g&&(d=g)):d=g;const w=o.length;d>w/2&&(d=w/2);let y;for(y=0;y<d;++y){const P=parseInt(o.substr(y*2,2),16);if(Yt(P))return y;l[s+y]=P}return y}function x(l,o,s,d){return _t(Jt(o,l.length-s),l,s,d)}function N(l,o,s,d){return _t(zi(o),l,s,d)}function z(l,o,s,d){return _t(Gr(o),l,s,d)}function O(l,o,s,d){return _t(ji(o,l.length-s),l,s,d)}u.prototype.write=function(o,s,d,g){if(s===void 0)g="utf8",d=this.length,s=0;else if(d===void 0&&typeof s=="string")g=s,d=this.length,s=0;else if(isFinite(s))s=s>>>0,isFinite(d)?(d=d>>>0,g===void 0&&(g="utf8")):(g=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const w=this.length-s;if((d===void 0||d>w)&&(d=w),o.length>0&&(d<0||s<0)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");g||(g="utf8");let y=!1;for(;;)switch(g){case"hex":return I(this,o,s,d);case"utf8":case"utf-8":return x(this,o,s,d);case"ascii":case"latin1":case"binary":return N(this,o,s,d);case"base64":return z(this,o,s,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,o,s,d);default:if(y)throw new TypeError("Unknown encoding: "+g);g=(""+g).toLowerCase(),y=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function H(l,o,s){return o===0&&s===l.length?e.fromByteArray(l):e.fromByteArray(l.slice(o,s))}function R(l,o,s){s=Math.min(l.length,s);const d=[];let g=o;for(;g<s;){const w=l[g];let y=null,P=w>239?4:w>223?3:w>191?2:1;if(g+P<=s){let X,Y,Q,V;switch(P){case 1:w<128&&(y=w);break;case 2:X=l[g+1],(X&192)===128&&(V=(w&31)<<6|X&63,V>127&&(y=V));break;case 3:X=l[g+1],Y=l[g+2],(X&192)===128&&(Y&192)===128&&(V=(w&15)<<12|(X&63)<<6|Y&63,V>2047&&(V<55296||V>57343)&&(y=V));break;case 4:X=l[g+1],Y=l[g+2],Q=l[g+3],(X&192)===128&&(Y&192)===128&&(Q&192)===128&&(V=(w&15)<<18|(X&63)<<12|(Y&63)<<6|Q&63,V>65535&&V<1114112&&(y=V))}}y===null?(y=65533,P=1):y>65535&&(y-=65536,d.push(y>>>10&1023|55296),y=56320|y&1023),d.push(y),g+=P}return k(d)}const F=4096;function k(l){const o=l.length;if(o<=F)return String.fromCharCode.apply(String,l);let s="",d=0;for(;d<o;)s+=String.fromCharCode.apply(String,l.slice(d,d+=F));return s}function B(l,o,s){let d="";s=Math.min(l.length,s);for(let g=o;g<s;++g)d+=String.fromCharCode(l[g]&127);return d}function j(l,o,s){let d="";s=Math.min(l.length,s);for(let g=o;g<s;++g)d+=String.fromCharCode(l[g]);return d}function Z(l,o,s){const d=l.length;(!o||o<0)&&(o=0),(!s||s<0||s>d)&&(s=d);let g="";for(let w=o;w<s;++w)g+=Wi[l[w]];return g}function ie(l,o,s){const d=l.slice(o,s);let g="";for(let w=0;w<d.length-1;w+=2)g+=String.fromCharCode(d[w]+d[w+1]*256);return g}u.prototype.slice=function(o,s){const d=this.length;o=~~o,s=s===void 0?d:~~s,o<0?(o+=d,o<0&&(o=0)):o>d&&(o=d),s<0?(s+=d,s<0&&(s=0)):s>d&&(s=d),s<o&&(s=o);const g=this.subarray(o,s);return Object.setPrototypeOf(g,u.prototype),g};function M(l,o,s){if(l%1!==0||l<0)throw new RangeError("offset is not uint");if(l+o>s)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(o,s,d){o=o>>>0,s=s>>>0,d||M(o,s,this.length);let g=this[o],w=1,y=0;for(;++y<s&&(w*=256);)g+=this[o+y]*w;return g},u.prototype.readUintBE=u.prototype.readUIntBE=function(o,s,d){o=o>>>0,s=s>>>0,d||M(o,s,this.length);let g=this[o+--s],w=1;for(;s>0&&(w*=256);)g+=this[o+--s]*w;return g},u.prototype.readUint8=u.prototype.readUInt8=function(o,s){return o=o>>>0,s||M(o,1,this.length),this[o]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(o,s){return o=o>>>0,s||M(o,2,this.length),this[o]|this[o+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(o,s){return o=o>>>0,s||M(o,2,this.length),this[o]<<8|this[o+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(o,s){return o=o>>>0,s||M(o,4,this.length),(this[o]|this[o+1]<<8|this[o+2]<<16)+this[o+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(o,s){return o=o>>>0,s||M(o,4,this.length),this[o]*16777216+(this[o+1]<<16|this[o+2]<<8|this[o+3])},u.prototype.readBigUInt64LE=Ae(function(o){o=o>>>0,ze(o,"offset");const s=this[o],d=this[o+7];(s===void 0||d===void 0)&&ye(o,this.length-8);const g=s+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24,w=this[++o]+this[++o]*2**8+this[++o]*2**16+d*2**24;return BigInt(g)+(BigInt(w)<<BigInt(32))}),u.prototype.readBigUInt64BE=Ae(function(o){o=o>>>0,ze(o,"offset");const s=this[o],d=this[o+7];(s===void 0||d===void 0)&&ye(o,this.length-8);const g=s*2**24+this[++o]*2**16+this[++o]*2**8+this[++o],w=this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+d;return(BigInt(g)<<BigInt(32))+BigInt(w)}),u.prototype.readIntLE=function(o,s,d){o=o>>>0,s=s>>>0,d||M(o,s,this.length);let g=this[o],w=1,y=0;for(;++y<s&&(w*=256);)g+=this[o+y]*w;return w*=128,g>=w&&(g-=Math.pow(2,8*s)),g},u.prototype.readIntBE=function(o,s,d){o=o>>>0,s=s>>>0,d||M(o,s,this.length);let g=s,w=1,y=this[o+--g];for(;g>0&&(w*=256);)y+=this[o+--g]*w;return w*=128,y>=w&&(y-=Math.pow(2,8*s)),y},u.prototype.readInt8=function(o,s){return o=o>>>0,s||M(o,1,this.length),this[o]&128?(255-this[o]+1)*-1:this[o]},u.prototype.readInt16LE=function(o,s){o=o>>>0,s||M(o,2,this.length);const d=this[o]|this[o+1]<<8;return d&32768?d|4294901760:d},u.prototype.readInt16BE=function(o,s){o=o>>>0,s||M(o,2,this.length);const d=this[o+1]|this[o]<<8;return d&32768?d|4294901760:d},u.prototype.readInt32LE=function(o,s){return o=o>>>0,s||M(o,4,this.length),this[o]|this[o+1]<<8|this[o+2]<<16|this[o+3]<<24},u.prototype.readInt32BE=function(o,s){return o=o>>>0,s||M(o,4,this.length),this[o]<<24|this[o+1]<<16|this[o+2]<<8|this[o+3]},u.prototype.readBigInt64LE=Ae(function(o){o=o>>>0,ze(o,"offset");const s=this[o],d=this[o+7];(s===void 0||d===void 0)&&ye(o,this.length-8);const g=this[o+4]+this[o+5]*2**8+this[o+6]*2**16+(d<<24);return(BigInt(g)<<BigInt(32))+BigInt(s+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24)}),u.prototype.readBigInt64BE=Ae(function(o){o=o>>>0,ze(o,"offset");const s=this[o],d=this[o+7];(s===void 0||d===void 0)&&ye(o,this.length-8);const g=(s<<24)+this[++o]*2**16+this[++o]*2**8+this[++o];return(BigInt(g)<<BigInt(32))+BigInt(this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+d)}),u.prototype.readFloatLE=function(o,s){return o=o>>>0,s||M(o,4,this.length),r.read(this,o,!0,23,4)},u.prototype.readFloatBE=function(o,s){return o=o>>>0,s||M(o,4,this.length),r.read(this,o,!1,23,4)},u.prototype.readDoubleLE=function(o,s){return o=o>>>0,s||M(o,8,this.length),r.read(this,o,!0,52,8)},u.prototype.readDoubleBE=function(o,s){return o=o>>>0,s||M(o,8,this.length),r.read(this,o,!1,52,8)};function q(l,o,s,d,g,w){if(!u.isBuffer(l))throw new TypeError('"buffer" argument must be a Buffer instance');if(o>g||o<w)throw new RangeError('"value" argument is out of bounds');if(s+d>l.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(o,s,d,g){if(o=+o,s=s>>>0,d=d>>>0,!g){const P=Math.pow(2,8*d)-1;q(this,o,s,d,P,0)}let w=1,y=0;for(this[s]=o&255;++y<d&&(w*=256);)this[s+y]=o/w&255;return s+d},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(o,s,d,g){if(o=+o,s=s>>>0,d=d>>>0,!g){const P=Math.pow(2,8*d)-1;q(this,o,s,d,P,0)}let w=d-1,y=1;for(this[s+w]=o&255;--w>=0&&(y*=256);)this[s+w]=o/y&255;return s+d},u.prototype.writeUint8=u.prototype.writeUInt8=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,1,255,0),this[s]=o&255,s+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,2,65535,0),this[s]=o&255,this[s+1]=o>>>8,s+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,2,65535,0),this[s]=o>>>8,this[s+1]=o&255,s+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,4,4294967295,0),this[s+3]=o>>>24,this[s+2]=o>>>16,this[s+1]=o>>>8,this[s]=o&255,s+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,4,4294967295,0),this[s]=o>>>24,this[s+1]=o>>>16,this[s+2]=o>>>8,this[s+3]=o&255,s+4};function ce(l,o,s,d,g){nt(o,d,g,l,s,7);let w=Number(o&BigInt(4294967295));l[s++]=w,w=w>>8,l[s++]=w,w=w>>8,l[s++]=w,w=w>>8,l[s++]=w;let y=Number(o>>BigInt(32)&BigInt(4294967295));return l[s++]=y,y=y>>8,l[s++]=y,y=y>>8,l[s++]=y,y=y>>8,l[s++]=y,s}function ne(l,o,s,d,g){nt(o,d,g,l,s,7);let w=Number(o&BigInt(4294967295));l[s+7]=w,w=w>>8,l[s+6]=w,w=w>>8,l[s+5]=w,w=w>>8,l[s+4]=w;let y=Number(o>>BigInt(32)&BigInt(4294967295));return l[s+3]=y,y=y>>8,l[s+2]=y,y=y>>8,l[s+1]=y,y=y>>8,l[s]=y,s+8}u.prototype.writeBigUInt64LE=Ae(function(o,s=0){return ce(this,o,s,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Ae(function(o,s=0){return ne(this,o,s,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(o,s,d,g){if(o=+o,s=s>>>0,!g){const X=Math.pow(2,8*d-1);q(this,o,s,d,X-1,-X)}let w=0,y=1,P=0;for(this[s]=o&255;++w<d&&(y*=256);)o<0&&P===0&&this[s+w-1]!==0&&(P=1),this[s+w]=(o/y>>0)-P&255;return s+d},u.prototype.writeIntBE=function(o,s,d,g){if(o=+o,s=s>>>0,!g){const X=Math.pow(2,8*d-1);q(this,o,s,d,X-1,-X)}let w=d-1,y=1,P=0;for(this[s+w]=o&255;--w>=0&&(y*=256);)o<0&&P===0&&this[s+w+1]!==0&&(P=1),this[s+w]=(o/y>>0)-P&255;return s+d},u.prototype.writeInt8=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,1,127,-128),o<0&&(o=255+o+1),this[s]=o&255,s+1},u.prototype.writeInt16LE=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,2,32767,-32768),this[s]=o&255,this[s+1]=o>>>8,s+2},u.prototype.writeInt16BE=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,2,32767,-32768),this[s]=o>>>8,this[s+1]=o&255,s+2},u.prototype.writeInt32LE=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,4,2147483647,-2147483648),this[s]=o&255,this[s+1]=o>>>8,this[s+2]=o>>>16,this[s+3]=o>>>24,s+4},u.prototype.writeInt32BE=function(o,s,d){return o=+o,s=s>>>0,d||q(this,o,s,4,2147483647,-2147483648),o<0&&(o=4294967295+o+1),this[s]=o>>>24,this[s+1]=o>>>16,this[s+2]=o>>>8,this[s+3]=o&255,s+4},u.prototype.writeBigInt64LE=Ae(function(o,s=0){return ce(this,o,s,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Ae(function(o,s=0){return ne(this,o,s,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function te(l,o,s,d,g,w){if(s+d>l.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function Ne(l,o,s,d,g){return o=+o,s=s>>>0,g||te(l,o,s,4),r.write(l,o,s,d,23,4),s+4}u.prototype.writeFloatLE=function(o,s,d){return Ne(this,o,s,!0,d)},u.prototype.writeFloatBE=function(o,s,d){return Ne(this,o,s,!1,d)};function Ee(l,o,s,d,g){return o=+o,s=s>>>0,g||te(l,o,s,8),r.write(l,o,s,d,52,8),s+8}u.prototype.writeDoubleLE=function(o,s,d){return Ee(this,o,s,!0,d)},u.prototype.writeDoubleBE=function(o,s,d){return Ee(this,o,s,!1,d)},u.prototype.copy=function(o,s,d,g){if(!u.isBuffer(o))throw new TypeError("argument should be a Buffer");if(d||(d=0),!g&&g!==0&&(g=this.length),s>=o.length&&(s=o.length),s||(s=0),g>0&&g<d&&(g=d),g===d||o.length===0||this.length===0)return 0;if(s<0)throw new RangeError("targetStart out of bounds");if(d<0||d>=this.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("sourceEnd out of bounds");g>this.length&&(g=this.length),o.length-s<g-d&&(g=o.length-s+d);const w=g-d;return this===o&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(s,d,g):Uint8Array.prototype.set.call(o,this.subarray(d,g),s),w},u.prototype.fill=function(o,s,d,g){if(typeof o=="string"){if(typeof s=="string"?(g=s,s=0,d=this.length):typeof d=="string"&&(g=d,d=this.length),g!==void 0&&typeof g!="string")throw new TypeError("encoding must be a string");if(typeof g=="string"&&!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);if(o.length===1){const y=o.charCodeAt(0);(g==="utf8"&&y<128||g==="latin1")&&(o=y)}}else typeof o=="number"?o=o&255:typeof o=="boolean"&&(o=Number(o));if(s<0||this.length<s||this.length<d)throw new RangeError("Out of range index");if(d<=s)return this;s=s>>>0,d=d===void 0?this.length:d>>>0,o||(o=0);let w;if(typeof o=="number")for(w=s;w<d;++w)this[w]=o;else{const y=u.isBuffer(o)?o:u.from(o,g),P=y.length;if(P===0)throw new TypeError('The value "'+o+'" is invalid for argument "value"');for(w=0;w<d-s;++w)this[w+s]=y[w%P]}return this};const ue={};function tt(l,o,s){ue[l]=class extends s{constructor(){super(),Object.defineProperty(this,"message",{value:o.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${l}]`,this.stack,delete this.name}get code(){return l}set code(g){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:g,writable:!0})}toString(){return`${this.name} [${l}]: ${this.message}`}}}tt("ERR_BUFFER_OUT_OF_BOUNDS",function(l){return l?`${l} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),tt("ERR_INVALID_ARG_TYPE",function(l,o){return`The "${l}" argument must be of type number. Received type ${typeof o}`},TypeError),tt("ERR_OUT_OF_RANGE",function(l,o,s){let d=`The value of "${l}" is out of range.`,g=s;return Number.isInteger(s)&&Math.abs(s)>2**32?g=rt(String(s)):typeof s=="bigint"&&(g=String(s),(s>BigInt(2)**BigInt(32)||s<-(BigInt(2)**BigInt(32)))&&(g=rt(g)),g+="n"),d+=` It must be ${o}. Received ${g}`,d},RangeError);function rt(l){let o="",s=l.length;const d=l[0]==="-"?1:0;for(;s>=d+4;s-=3)o=`_${l.slice(s-3,s)}${o}`;return`${l.slice(0,s)}${o}`}function bt(l,o,s){ze(o,"offset"),(l[o]===void 0||l[o+s]===void 0)&&ye(o,l.length-(s+1))}function nt(l,o,s,d,g,w){if(l>s||l<o){const y=typeof o=="bigint"?"n":"";let P;throw w>3?o===0||o===BigInt(0)?P=`>= 0${y} and < 2${y} ** ${(w+1)*8}${y}`:P=`>= -(2${y} ** ${(w+1)*8-1}${y}) and < 2 ** ${(w+1)*8-1}${y}`:P=`>= ${o}${y} and <= ${s}${y}`,new ue.ERR_OUT_OF_RANGE("value",P,l)}bt(d,g,w)}function ze(l,o){if(typeof l!="number")throw new ue.ERR_INVALID_ARG_TYPE(o,"number",l)}function ye(l,o,s){throw Math.floor(l)!==l?(ze(l,s),new ue.ERR_OUT_OF_RANGE(s||"offset","an integer",l)):o<0?new ue.ERR_BUFFER_OUT_OF_BOUNDS:new ue.ERR_OUT_OF_RANGE(s||"offset",`>= ${s?1:0} and <= ${o}`,l)}const Li=/[^+/0-9A-Za-z-_]/g;function $i(l){if(l=l.split("=")[0],l=l.trim().replace(Li,""),l.length<2)return"";for(;l.length%4!==0;)l=l+"=";return l}function Jt(l,o){o=o||1/0;let s;const d=l.length;let g=null;const w=[];for(let y=0;y<d;++y){if(s=l.charCodeAt(y),s>55295&&s<57344){if(!g){if(s>56319){(o-=3)>-1&&w.push(239,191,189);continue}else if(y+1===d){(o-=3)>-1&&w.push(239,191,189);continue}g=s;continue}if(s<56320){(o-=3)>-1&&w.push(239,191,189),g=s;continue}s=(g-55296<<10|s-56320)+65536}else g&&(o-=3)>-1&&w.push(239,191,189);if(g=null,s<128){if((o-=1)<0)break;w.push(s)}else if(s<2048){if((o-=2)<0)break;w.push(s>>6|192,s&63|128)}else if(s<65536){if((o-=3)<0)break;w.push(s>>12|224,s>>6&63|128,s&63|128)}else if(s<1114112){if((o-=4)<0)break;w.push(s>>18|240,s>>12&63|128,s>>6&63|128,s&63|128)}else throw new Error("Invalid code point")}return w}function zi(l){const o=[];for(let s=0;s<l.length;++s)o.push(l.charCodeAt(s)&255);return o}function ji(l,o){let s,d,g;const w=[];for(let y=0;y<l.length&&!((o-=2)<0);++y)s=l.charCodeAt(y),d=s>>8,g=s%256,w.push(g),w.push(d);return w}function Gr(l){return e.toByteArray($i(l))}function _t(l,o,s,d){let g;for(g=0;g<d&&!(g+s>=o.length||g>=l.length);++g)o[g+s]=l[g];return g}function fe(l,o){return l instanceof o||l!=null&&l.constructor!=null&&l.constructor.name!=null&&l.constructor.name===o.name}function Yt(l){return l!==l}const Wi=function(){const l="0123456789abcdef",o=new Array(256);for(let s=0;s<16;++s){const d=s*16;for(let g=0;g<16;++g)o[d+g]=l[s]+l[g]}return o}();function Ae(l){return typeof BigInt>"u"?Hi:l}function Hi(){throw new Error("BigInt not supported")}})(Ue);var oe=Uint8Array,se=Uint16Array,Wt=Uint32Array,Ht=new oe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vt=new oe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yr=new oe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$n=function(t,e){for(var r=new se(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new Wt(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return[r,i]},zn=$n(Ht,2),jn=zn[0],vr=zn[1];jn[28]=258,vr[258]=28;var Wn=$n(Vt,0),Ko=Wn[0],Xr=Wn[1],Ir=new se(32768);for(var J=0;J<32768;++J){var Se=(J&43690)>>>1|(J&21845)<<1;Se=(Se&52428)>>>2|(Se&13107)<<2,Se=(Se&61680)>>>4|(Se&3855)<<4,Ir[J]=((Se&65280)>>>8|(Se&255)<<8)>>>1}var ge=function(t,e,r){for(var n=t.length,i=0,a=new se(e);i<n;++i)t[i]&&++a[t[i]-1];var c=new se(e);for(i=0;i<e;++i)c[i]=c[i-1]+a[i-1]<<1;var u;if(r){u=new se(1<<e);var h=15-e;for(i=0;i<n;++i)if(t[i])for(var f=i<<4|t[i],p=e-t[i],m=c[t[i]-1]++<<p,v=m|(1<<p)-1;m<=v;++m)u[Ir[m]>>>h]=f}else for(u=new se(n),i=0;i<n;++i)t[i]&&(u[i]=Ir[c[t[i]-1]++]>>>15-t[i]);return u},Re=new oe(288);for(var J=0;J<144;++J)Re[J]=8;for(var J=144;J<256;++J)Re[J]=9;for(var J=256;J<280;++J)Re[J]=7;for(var J=280;J<288;++J)Re[J]=8;var ft=new oe(32);for(var J=0;J<32;++J)ft[J]=5;var Jo=ge(Re,9,0),Yo=ge(Re,9,1),Xo=ge(ft,5,0),Qo=ge(ft,5,1),sr=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},he=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},ar=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},Lr=function(t){return(t+7)/8|0},Hn=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new(t.BYTES_PER_ELEMENT==2?se:t.BYTES_PER_ELEMENT==4?Wt:oe)(r-e);return n.set(t.subarray(e,r)),n},Zo=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xe=function(t,e,r){var n=new Error(e||Zo[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,xe),!r)throw n;return n},es=function(t,e,r){var n=t.length;if(!n||r&&r.f&&!r.l)return e||new oe(0);var i=!e||r,a=!r||r.i;r||(r={}),e||(e=new oe(n*3));var c=function(Ne){var Ee=e.length;if(Ne>Ee){var ue=new oe(Math.max(Ee*2,Ne));ue.set(e),e=ue}},u=r.f||0,h=r.p||0,f=r.b||0,p=r.l,m=r.d,v=r.m,E=r.n,C=n*8;do{if(!p){u=he(t,h,1);var D=he(t,h+1,3);if(h+=3,D)if(D==1)p=Yo,m=Qo,v=9,E=5;else if(D==2){var W=he(t,h,31)+257,A=he(t,h+10,15)+4,S=W+he(t,h+5,31)+1;h+=14;for(var _=new oe(S),b=new oe(19),I=0;I<A;++I)b[yr[I]]=he(t,h+I*3,7);h+=A*3;for(var x=sr(b),N=(1<<x)-1,z=ge(b,x,1),I=0;I<S;){var O=z[he(t,h,N)];h+=O&15;var T=O>>>4;if(T<16)_[I++]=T;else{var H=0,R=0;for(T==16?(R=3+he(t,h,3),h+=2,H=_[I-1]):T==17?(R=3+he(t,h,7),h+=3):T==18&&(R=11+he(t,h,127),h+=7);R--;)_[I++]=H}}var F=_.subarray(0,W),k=_.subarray(W);v=sr(F),E=sr(k),p=ge(F,v,1),m=ge(k,E,1)}else xe(1);else{var T=Lr(h)+4,L=t[T-4]|t[T-3]<<8,$=T+L;if($>n){a&&xe(0);break}i&&c(f+L),e.set(t.subarray(T,$),f),r.b=f+=L,r.p=h=$*8,r.f=u;continue}if(h>C){a&&xe(0);break}}i&&c(f+131072);for(var B=(1<<v)-1,j=(1<<E)-1,Z=h;;Z=h){var H=p[ar(t,h)&B],ie=H>>>4;if(h+=H&15,h>C){a&&xe(0);break}if(H||xe(2),ie<256)e[f++]=ie;else if(ie==256){Z=h,p=null;break}else{var M=ie-254;if(ie>264){var I=ie-257,q=Ht[I];M=he(t,h,(1<<q)-1)+jn[I],h+=q}var ce=m[ar(t,h)&j],ne=ce>>>4;ce||xe(3),h+=ce&15;var k=Ko[ne];if(ne>3){var q=Vt[ne];k+=ar(t,h)&(1<<q)-1,h+=q}if(h>C){a&&xe(0);break}i&&c(f+131072);for(var te=f+M;f<te;f+=4)e[f]=e[f-k],e[f+1]=e[f+1-k],e[f+2]=e[f+2-k],e[f+3]=e[f+3-k];f=te}}r.l=p,r.p=Z,r.b=f,r.f=u,p&&(u=1,r.m=v,r.d=m,r.n=E)}while(!u);return f==e.length?e:Hn(e,0,f)},ve=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>>8},ot=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>>8,t[n+2]|=r>>>16},cr=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var i=r.length,a=r.slice();if(!i)return[$r,0];if(i==1){var c=new oe(r[0].s+1);return c[r[0].s]=1,[c,1]}r.sort(function(S,_){return S.f-_.f}),r.push({s:-1,f:25001});var u=r[0],h=r[1],f=0,p=1,m=2;for(r[0]={s:-1,f:u.f+h.f,l:u,r:h};p!=i-1;)u=r[r[f].f<r[m].f?f++:m++],h=r[f!=p&&r[f].f<r[m].f?f++:m++],r[p++]={s:-1,f:u.f+h.f,l:u,r:h};for(var v=a[0].s,n=1;n<i;++n)a[n].s>v&&(v=a[n].s);var E=new se(v+1),C=br(r[p-1],E,0);if(C>e){var n=0,D=0,T=C-e,L=1<<T;for(a.sort(function(_,b){return E[b.s]-E[_.s]||_.f-b.f});n<i;++n){var $=a[n].s;if(E[$]>e)D+=L-(1<<C-E[$]),E[$]=e;else break}for(D>>>=T;D>0;){var W=a[n].s;E[W]<e?D-=1<<e-E[W]++-1:++n}for(;n>=0&&D;--n){var A=a[n].s;E[A]==e&&(--E[A],++D)}C=e}return[new oe(E),C]},br=function(t,e,r){return t.s==-1?Math.max(br(t.l,e,r+1),br(t.r,e,r+1)):e[t.s]=r},Qr=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new se(++e),n=0,i=t[0],a=1,c=function(h){r[n++]=h},u=1;u<=e;++u)if(t[u]==i&&u!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)c(32754);a>2&&(c(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(c(i),--a;a>6;a-=6)c(8304);a>2&&(c(a-3<<5|8208),a=0)}for(;a--;)c(i);a=1,i=t[u]}return[r.subarray(0,n),e]},st=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},_r=function(t,e,r){var n=r.length,i=Lr(e+2);t[i]=n&255,t[i+1]=n>>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var a=0;a<n;++a)t[i+a+4]=r[a];return(i+4+n)*8},Zr=function(t,e,r,n,i,a,c,u,h,f,p){ve(e,p++,r),++i[256];for(var m=cr(i,15),v=m[0],E=m[1],C=cr(a,15),D=C[0],T=C[1],L=Qr(v),$=L[0],W=L[1],A=Qr(D),S=A[0],_=A[1],b=new se(19),I=0;I<$.length;++I)b[$[I]&31]++;for(var I=0;I<S.length;++I)b[S[I]&31]++;for(var x=cr(b,7),N=x[0],z=x[1],O=19;O>4&&!N[yr[O-1]];--O);var H=f+5<<3,R=st(i,Re)+st(a,ft)+c,F=st(i,v)+st(a,D)+c+14+3*O+st(b,N)+(2*b[16]+3*b[17]+7*b[18]);if(H<=R&&H<=F)return _r(e,p,t.subarray(h,h+f));var k,B,j,Z;if(ve(e,p,1+(F<R)),p+=2,F<R){k=ge(v,E,0),B=v,j=ge(D,T,0),Z=D;var ie=ge(N,z,0);ve(e,p,W-257),ve(e,p+5,_-1),ve(e,p+10,O-4),p+=14;for(var I=0;I<O;++I)ve(e,p+3*I,N[yr[I]]);p+=3*O;for(var M=[$,S],q=0;q<2;++q)for(var ce=M[q],I=0;I<ce.length;++I){var ne=ce[I]&31;ve(e,p,ie[ne]),p+=N[ne],ne>15&&(ve(e,p,ce[I]>>>5&127),p+=ce[I]>>>12)}}else k=Jo,B=Re,j=Xo,Z=ft;for(var I=0;I<u;++I)if(n[I]>255){var ne=n[I]>>>18&31;ot(e,p,k[ne+257]),p+=B[ne+257],ne>7&&(ve(e,p,n[I]>>>23&31),p+=Ht[ne]);var te=n[I]&31;ot(e,p,j[te]),p+=Z[te],te>3&&(ot(e,p,n[I]>>>5&8191),p+=Vt[te])}else ot(e,p,k[n[I]]),p+=B[n[I]];return ot(e,p,k[256]),p+B[256]},ts=new Wt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),$r=new oe(0),rs=function(t,e,r,n,i,a){var c=t.length,u=new oe(n+c+5*(1+Math.ceil(c/7e3))+i),h=u.subarray(n,u.length-i),f=0;if(!e||c<8)for(var p=0;p<=c;p+=65535){var m=p+65535;m>=c&&(h[f>>3]=a),f=_r(h,f+1,t.subarray(p,m))}else{for(var v=ts[e-1],E=v>>>13,C=v&8191,D=(1<<r)-1,T=new se(32768),L=new se(D+1),$=Math.ceil(r/3),W=2*$,A=function(ye){return(t[ye]^t[ye+1]<<$^t[ye+2]<<W)&D},S=new Wt(25e3),_=new se(288),b=new se(32),I=0,x=0,p=0,N=0,z=0,O=0;p<c;++p){var H=A(p),R=p&32767,F=L[H];if(T[R]=F,L[H]=R,z<=p){var k=c-p;if((I>7e3||N>24576)&&k>423){f=Zr(t,h,0,S,_,b,x,N,O,p-O,f),N=I=x=0,O=p;for(var B=0;B<286;++B)_[B]=0;for(var B=0;B<30;++B)b[B]=0}var j=2,Z=0,ie=C,M=R-F&32767;if(k>2&&H==A(p-M))for(var q=Math.min(E,k)-1,ce=Math.min(32767,p),ne=Math.min(258,k);M<=ce&&--ie&&R!=F;){if(t[p+j]==t[p+j-M]){for(var te=0;te<ne&&t[p+te]==t[p+te-M];++te);if(te>j){if(j=te,Z=M,te>q)break;for(var Ne=Math.min(M,te-2),Ee=0,B=0;B<Ne;++B){var ue=p-M+B+32768&32767,tt=T[ue],rt=ue-tt+32768&32767;rt>Ee&&(Ee=rt,F=ue)}}}R=F,F=T[R],M+=R-F+32768&32767}if(Z){S[N++]=268435456|vr[j]<<18|Xr[Z];var bt=vr[j]&31,nt=Xr[Z]&31;x+=Ht[bt]+Vt[nt],++_[257+bt],++b[nt],z=p+j,++I}else S[N++]=t[p],++_[t[p]]}}f=Zr(t,h,a,S,_,b,x,N,O,p-O,f),!a&&f&7&&(f=_r(h,f+1,$r))}return Hn(u,0,n+Lr(f)+i)},ns=function(t,e,r,n,i){return rs(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,!i)};function Vn(t,e){return ns(t,e||{},0,0)}function is(t,e){return es(t,e)}var os=typeof TextDecoder<"u"&&new TextDecoder,ss=0;try{os.decode($r,{stream:!0}),ss=1}catch{}function as(t){const e=Ue.Buffer.from(t,"base64"),r=is(e),n=new TextDecoder().decode(r);return JSON.parse(n)}function cs(t){const e=JSON.stringify(t),r=new TextEncoder().encode(e),n=Vn(r);return Ue.Buffer.from(n).toString("base64")}K.initialize({product:"h2d",version:chrome?.runtime?.getManifest()?.version,properties:{source:"chrome-extension"}});K.setStackCleaner(t=>t.replace(/chrome-extension:\/\/[^/]+/g,""));const Gt=()=>chrome.action.openPopup?.().catch(t=>console.info("Popup not open, probably already open",t));async function Gn(t,e,r={maxRetries:3,retryDelay:50}){async function n(i=0){try{return i>=r.maxRetries?!1:await Pn(t,e,"popup")}catch{return mt(r.retryDelay).then(()=>n(i+1))}}return await Gt().then(()=>n())}const us=.77,en=95;function me(t){return{context:"content-script",tabId:t.tabId,frameId:t.frameIds?.[0]}}async function ls(t,e,r,n,{beforeDomSnapshot:i}={}){const a={};chrome.debugger.onEvent.addListener((A,S,_)=>{if(S==="CSS.fontsUpdated"){const b=_.font;if(b){const I=JSON.stringify(b,(x,N)=>x==="src"?void 0:N);a[I]={...b,source:A}}}S==="Debugger.paused"&&c.send("Debugger.resume")}),e.push(hs());const{client:c,dispose:u}=await tn(t),h=Jn(c,r);e.push({name:"main cdpclient",action:u}),i&&await i(c);const{root:f}=await c.send("DOM.getDocument",{depth:en,pierce:!0}),p=await h,m=new Map([[`${t.tabId}:0`,p]]);await qn(c,p,f);let v;const E={},C=async(A,S)=>{const{client:_,root:b}=W(A.frameId||S);return D(_,b.nodeId,A).catch(I=>{throw console.warn("getNodeId failed",A,I),I})},D=async(A,S,_)=>{const{idx:b,contentDocument:I,selectors:x}=_;let N=_.nodeId;if(!N){const z=x[0];if(!z)throw new Error("Empty selector");const O={nodeId:S,selector:z};({nodeId:N}=await A.send("DOM.querySelector",O))}if(x.length>1){const{node:z}=await A.send("DOM.describeNode",{nodeId:N});let O=z.contentDocument;z.shadowRoots&&(z.shadowRoots.length>1&&console.warn("Unsupported multiple shadowRoots",{nodeId:N}),O=z.shadowRoots[0]);const H=await at(A,O);if(H!==void 0)return D(A,H,{..._,selectors:x.slice(1)});throw new Error("No document root but pending selectors",{cause:{selectors:x}})}else if(b!==void 0){const z={nodeId:N,depth:2},{node:O}=await A.send("DOM.describeNode",z),H=await at(A,O.children?.[b]);return{client:A,nodeId:H||N}}else if(I){const{node:z}=await A.send("DOM.describeNode",{nodeId:N}),O=await at(A,z.contentDocument);if(!O)throw new Error("Unable to resolve content document for selector",{cause:{selector:_}});return{client:A,nodeId:O}}else return{client:A,nodeId:N}};function T(A,S){const _=b=>{let I=A;return b.type==="extension"&&(I=W(b.apiFrameId).client),I};return{getResourceTree:b=>_(b).send("Page.getResourceTree",{}),getResourceContent:({meta:b,cdpFrameId:I,url:x})=>Po(_(b),{frameId:I,url:x}),fetchAsset:async(b,I)=>{const x=b.type==="extension"?me({...t,frameIds:[b.apiFrameId]}):{...S};let N=await ae("fetchResource",{url:I},x);if(N||(N=await Lo(I,globalThis.fetch,z=>Ue.Buffer.from(z).toString("base64"))),!N)throw new Error("Unable to fetch asset",{cause:{url:I}});return{...N,base64Encoded:!0}}}}re("fetchShadowRoot",async({data:{selector:A},sender:S})=>{let _,b;try{({client:_,nodeId:b}=await C(A,S.frameId))}catch{return}const I=m.get(`${S.tabId}:${S.frameId||0}`);if(!I){console.warn("Missing executionContextId for ",S);return}return fo(_,I,{nodeId:b})}),re("fetchContentDocument",async({data:{selector:A},sender:S})=>{let _,b;try{({client:_,nodeId:b}=await C(A,S.frameId))}catch{return}const I=m.get(`${S.tabId}:${S.frameId||0}`);if(!I){console.warn("Missing executionContextId for ",S);return}return po(_,I,{nodeId:b})}),re("fetchBeforeAfter",async({data:{selector:A},sender:S})=>{const _=A.frameId||S.frameId,{client:b,nodeId:I}=await C(A,_),x=m.get(`${S.tabId}:${_||0}`);return uo(b,x,{nodeId:I},!!A.frameId)}),re("getPlatformFontForNode",async({data:{selector:A,pseudo:S},sender:{frameId:_}})=>{const{client:b,nodeId:I}=await C(A,_);return lo(b,I,S)}),re("forcePseudoState",async({data:{selector:A,forcedPseudoClasses:S,pseudo:_},sender:{frameId:b}})=>{const{client:I,nodeId:x}=await C(A,b);return ho(I,x,S,_)}),re("getBoxModel",async({data:{selector:A},sender:{frameId:S}})=>{const{client:_,nodeId:b}=await C(A,S),{model:I}=await _.send("DOM.getBoxModel",{nodeId:b}).catch(()=>({model:void 0}));return I}),re("getContentQuads",async({data:{selector:A},sender:{frameId:S}})=>{const{client:_,nodeId:b}=await C(A,S),{quads:I}=await _.send("DOM.getContentQuads",{nodeId:b});return I});const L=-1;async function $(A,S,_){const b=JSON.stringify(_);if(E[b])return E[b];console.debug("Looking for CDP for frame:",_);const{nodeId:I,client:x}=await C(_,_.frameId||A.frameId),N=await x.send("DOM.describeNode",{nodeId:I}).catch(()=>{});if(!N)return;const{node:z}=N,O=!!(z.attributes||[]).find(k=>k==="srcdoc"),R=(await chrome.debugger.getTargets()).find(k=>k.id===z.frameId)||null;v??=await chrome.webNavigation.getAllFrames(t)||[];const F=k=>v.find(({url:B})=>B===k)?.frameId||L;if(!R){const k=z.contentDocument;if(k?.documentURL){const B=F(k.documentURL),j={client:x,root:k,frameId:B};return E[b]=j}return}try{const{client:k,dispose:B}=await tn({targetId:R.id});S.push({name:`cdpclient for ${b}`,action:B});const{root:j}=await k.send("DOM.getDocument",{depth:en,pierce:!0}),Z={client:k,root:j,targetId:R.id,frameId:F(R.url),isSrcDoc:O};return E[b]=Z}catch(k){console.warn(k,R.url)}}re("serializeIFrame",async({data:{selector:A,opts:S,state:_,url:b},sender:I})=>{if(console.log("Serializing iframe",A),!(!await chrome.permissions.contains({origins:[b]})&&!await fs(["*",ps(b)],"capture")))try{const x=await $(I,e,A);if(!x){K.exception("serializeIFrame",new Error("No CDP found for frame"),{url:b});return}const N={type:"extension",apiFrameId:x.frameId};let z=!0;try{const O={...t,frameIds:[x.frameId]},{frameId:H,executionContextId:R}=await ds(x.client,O,n,x?.root);return z=!1,m.set(`${O.tabId}:${H}`,R),{compressedFrame:await ae("serializeBody",{opts:S,state:_},me(O)),$assetsMeta:N}}catch(O){if(z&&(x.isSrcDoc||x.frameId===L)){const{client:H,frameId:R}=x,F=await fetch(chrome.runtime.getURL("assets/src/contentScript/serializeDom/serializeIframe.js")).then(j=>j.text()),k=await H.send("Runtime.evaluate",{expression:`if(!window.__h2d_serializeIframe)(function (){${F}})();
                __h2d_serializeIframe(${R},${JSON.stringify(S)});`,returnByValue:!0,awaitPromise:!0}).catch(j=>console.error("Error serializing srcdoc iframe",j)),B=k?.result?.value;if(B){const{frame:j,doc:Z}=B;return{compressedFrame:cs({frame:j,doc:Z}),$assetsMeta:N}}else throw k?.exceptionDetails||new Error("empty result")}throw O}}catch(x){throw K.exception("serializeIFrame",x,{url:b}),x}}),re("getAssetWithCDP",async({sender:A,data:{url:S}})=>{if(!ee){console.error("No task in progress");return}const _=ee,b=_.assetsCache[S]??=(await Mn({urlWithMeta:{[S]:{type:"default"}},client:T(c,A),cache:_.assetsCache}))[S];if(b)return b.base64Encoded?Ue.Buffer.from(b.content,"base64").toString():b.content}),re("storeSerializedFrame",async({sender:A,data:{content:S,screenshotRect:_}})=>{const b=as(S);if(!ee)throw new Error("No task in progress");const I=ee,x=await Bo({baseURI:b.doc.baseURI,frame:b.frame,client:T(c,A),acceptLocalFiles:!0,cache:I.assetsCache}),N=Object.values(a);console.log("Captured fonts",N);const z=Object.fromEntries(Object.values(E).filter(R=>!!R.targetId).map(R=>[R.targetId,R.frameId])),O=Object.values(a).reduce((R,F)=>{const k=F.source.targetId&&z[F.source.targetId],B=k&&k!==L?me({...t,frameIds:[k]}):{...A};let j=R.get(B);return j||R.set(B,j=[]),j.push(F),R},new Map);for(const[R,F]of O.entries())F.length&&(console.log("Fonts to download for",R,F),await go(x,F,k=>ae("fetchResource",{url:k.src},R),ee?.assetsCache));Object.assign(I.assetsCache,x);const H={...b,assets:x,fonts:N,url:I.url};if(I.full&&(H.theme=I.tasks[I.currentIdx].theme,H.width=I.tasks[I.currentIdx].width),ee.saveLocation==="gstorage"&&!I.screenshot){ee.full&&(_.height=_.width*9/16);try{const F=(await c.send("Page.captureScreenshot",{format:"png",clip:{..._,scale:1}})).data,k=await createImageBitmap(new Blob([Ue.Buffer.from(F,"base64")])),B=256,j=k.width/k.height,Z=Math.round(B/j),ie=new OffscreenCanvas(B,Z);ie.getContext("2d").drawImage(k,0,0,B,Z),I.screenshot=Ue.Buffer.from(await(await ie.convertToBlob({type:"image/webp",quality:us})).arrayBuffer()).toString("base64")}catch(R){K.exception("screeshot:Page.captureScreenshot",R)}}I.serializedFrames.push(H)});const W=A=>A&&Object.values(E).find(S=>S.frameId===A)||{client:c,root:f,frameId:0}}async function qn(t,e,r){const n=[];if(function a(c){const u=c.shadowRoots?.find(h=>h.shadowRootType!=="open");u&&n.push({backendNodeId:c.backendNodeId,shadowRootNodeId:u.nodeId}),[...c.children||[],...c.shadowRoots||[]].forEach(a)}(r),!n.length)return;const i=await Promise.all(n.map(({backendNodeId:a})=>t.send("DOM.resolveNode",{backendNodeId:a,executionContextId:e}).then(c=>c.object.objectId)));await t.send("Runtime.callFunctionOn",{functionDeclaration:function(...a){for(let c=0;c<a.length/2;c++)a[c].setAttribute("__h2d_shadowRoot",a[a.length/2+c])}.toString(),executionContextId:e,arguments:[...i.map(a=>({objectId:a})),...n.map(({shadowRootNodeId:a})=>({value:a}))],returnByValue:!0})}async function ds(t,e,r,n){const{frameId:i,contentScriptId:a}=await Kn(e,r),c=await Jn(t,a);return n&&await qn(t,c,n),{executionContextId:c,frameId:i}}async function Kn(t,e){const r=await chrome.scripting.executeScript({target:t,files:["assets/src/contentScript/index.js"]});return await ae("setCaptureAnalytics",e,me(t)).catch(n=>K.exception("setCaptureAnalytics",n)),{contentScriptId:r[0].result,frameId:r[0].frameId}}const Er=new Set;function hs(){const t=async(e,r,n)=>{r==="Debugger.scriptParsed"&&n?.url===`chrome-extension://${chrome.runtime.id}/assets/src/contentScript/index.js`&&Er.add(n.executionContextId)};return chrome.debugger.onEvent.addListener(t),{name:"content script listener",terminal:!0,action:()=>{chrome.debugger.onEvent.removeListener(t),Er.clear()}}}async function Jn(t,e){const r=new Set,n=Date.now();for(;Date.now()-n<5e3;){for(const i of Er)if(!r.has(i)){r.add(i);try{if((await t.send("Runtime.callFunctionOn",{functionDeclaration:function(){return window.contentScriptId}.toString(),executionContextId:i,returnByValue:!0})).result.value===e)return i}catch(a){console.debug(`Error fetching contentScriptId (ctxId ${i})`,a)}}await mt(100)}throw new Error("contentScriptExecCtxId lookup timed out",{cause:{contentScriptId:e}})}async function tn(t){let e;return{client:{send:async(n,i)=>(e||(e=Ye(`connecting cdp client for ${JSON.stringify(t)}`,async()=>{await async function a(c,u,h){try{await chrome.debugger.attach(t,"1.3")}catch(f){if(String(f).includes("chrome-extension:// URL")&&c+u>Date.now())return console.log("Another chrome-extension is blocking CDP, retrying in 100ms"),await mt(h),a(c,u,h);throw f}}(Date.now(),500,100),await Promise.all([chrome.debugger.sendCommand(t,"DOM.enable"),chrome.debugger.sendCommand(t,"CSS.enable"),chrome.debugger.sendCommand(t,"Page.enable"),chrome.debugger.sendCommand(t,"Debugger.enable")])}),await e),chrome.debugger.sendCommand(t,n,i))},dispose:()=>chrome.debugger.detach(t)}}async function fs(t,e){if(await Gn("requestAccess",{domains:t,action:e})){const{promise:r,resolve:n,error:i}=Br();try{return chrome.permissions.onAdded.addListener(n),await Promise.race([r,mt(1e4).then(i)]),!0}catch{return!1}finally{chrome.permissions.onAdded.removeListener(n)}}else return!1}const ps=t=>{try{return new URL(t).hostname.split(".").map((e,r,n)=>r===0&&n.length>2?"*":e).join(".")}catch{return"*"}},rn={16:"icons/16.png",19:"icons/19.png",32:"icons/32.png",38:"icons/38.png"},gs=t=>e=>t.fontFamily===e.fontFamily&&t.fontStretch===e.fontStretch&&t.fontStyle===e.fontStyle&&t.fontWeight===e.fontWeight&&t.platformFontFamily===e.platformFontFamily&&t.src===e.src&&t.unicodeRange===e.unicodeRange;function ms(t){return t.replace(/^[a-z]+:\/\//i,"").replace(/(?:\/|(?:\/index)?.html)$/i,"").replace(/[^a-zA-Z0-9_\-]/g,"_").replace(/__+/g,"_")}let Yn;const ws=t=>{Yn=t};function Rt(t,e,r){const n=t,i=e,a=i?.analytics||K.isInitialized&&K,c=i?.source||Yn;if(!c){const p="No source provided and defaultSource has not been set";throw console.error(p),new Error(p)}const u=p=>Array.isArray(i?.retry)&&i.retry.includes(p),h=r,f=p=>{let m=n,v=typeof n=="object"&&"url"in n?n.url:String(n);if(p&&i?.fallbacks)if(v=ys(v,i.fallbacks),typeof m=="string")m=v;else throw new Error("Retry with fallback only supported for string requests");return Ye(`fetch ${m}${p?" (retry)":""}`,()=>fetch(m,i),async({duration:E,result:C})=>{const D=i?.tracking||"both",T="ret"in C,L=T&&C.ret.ok;if(!(D==="success"&&!L||D==="error"&&L)&&a){const $={...i?.extraTrackingProps,url:v,duration:E,retry:p,source:c},W=i?.method&&i.method.toLowerCase();if(W!=="get"&&($.method=i?.method),(W==="post"||W==="put")&&i?.body){const A=Xn(i.body);A!==void 0&&($.requestPayloadSize=A)}if(T){const A=C.ret,S={...$,code:C.ret.status},_=!L&&await A.clone().text().catch(()=>"");_&&(S.message=_),nn(a,S)}else nn(a,{...$,message:C.error?.message||C.error})}}).then(E=>{if(!p&&u(E.status))throw new Error("Retry");return E}).then(E=>h?h(E):E)};return f().catch(p=>{if(p.name==="AbortError"||!i?.retry)throw p;return f(!0)})}function Xn(t){if(!!t){if(typeof t=="string")return new TextEncoder().encode(t).length;if(typeof t=="object"){if(t instanceof FormData)return Array.from(t.values()).reduce((e,r)=>e+(Xn(r)||0),0);if("length"in t)return t.length;if("size"in t)return t.size;if("byteLength"in t)return t.byteLength}}}function nn(t,e){t.track("fetch",{properties:{...e,type:"message"in e?"error":"success"}},{country:!0})}function ys(t,e){for(const[r,n]of Object.entries(e)){const i=t.replace(r,n);if(i!==t)return i}return t}const vs=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qn=function(t){const e=[];let r=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=i&63|128):(i&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++n)&1023),e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=i&63|128):(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=i&63|128)}return e},Is=function(t){const e=[];let r=0,n=0;for(;r<t.length;){const i=t[r++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const a=t[r++];e[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=t[r++],c=t[r++],u=t[r++],h=((i&7)<<18|(a&63)<<12|(c&63)<<6|u&63)-65536;e[n++]=String.fromCharCode(55296+(h>>10)),e[n++]=String.fromCharCode(56320+(h&1023))}else{const a=t[r++],c=t[r++];e[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|c&63)}}return e.join("")},Zn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<t.length;i+=3){const a=t[i],c=i+1<t.length,u=c?t[i+1]:0,h=i+2<t.length,f=h?t[i+2]:0,p=a>>2,m=(a&3)<<4|u>>4;let v=(u&15)<<2|f>>6,E=f&63;h||(E=64,c||(v=64)),n.push(r[p],r[m],r[v],r[E])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Qn(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Is(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<t.length;){const a=r[t.charAt(i++)],u=i<t.length?r[t.charAt(i)]:0;++i;const f=i<t.length?r[t.charAt(i)]:64;++i;const m=i<t.length?r[t.charAt(i)]:64;if(++i,a==null||u==null||f==null||m==null)throw new bs;const v=a<<2|u>>4;if(n.push(v),f!==64){const E=u<<4&240|f>>2;if(n.push(E),m!==64){const C=f<<6&192|m;n.push(C)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class bs extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _s=function(t){const e=Qn(t);return Zn.encodeByteArray(e,!0)},ei=function(t){return _s(t).replace(/\./g,"")},ti=function(t){try{return Zn.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Es(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const As=()=>Es().__FIREBASE_DEFAULTS__,Ss=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Cs=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&ti(t[1]);return e&&JSON.parse(e)},ri=()=>{try{return vs()||As()||Ss()||Cs()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},xs=t=>{var e,r;return(r=(e=ri())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},ni=()=>{var t;return(t=ri())===null||t===void 0?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,n)=>{r?this.reject(r):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,n))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function we(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ks(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(we())}function Ds(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Rs(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Ns(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Os(){try{return typeof indexedDB=="object"}catch{return!1}}function Ps(){return new Promise((t,e)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),t(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var a;e(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bs="FirebaseError";class $e extends Error{constructor(e,r,n){super(r),this.code=e,this.customData=n,this.name=Bs,Object.setPrototypeOf(this,$e.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,wt.prototype.create)}}class wt{constructor(e,r,n){this.service=e,this.serviceName=r,this.errors=n}create(e,...r){const n=r[0]||{},i=`${this.service}/${e}`,a=this.errors[e],c=a?Us(a,n):"Error",u=`${this.serviceName}: ${c} (${i}).`;return new $e(i,u,n)}}function Us(t,e){return t.replace(Fs,(r,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const Fs=/\{\$([^}]+)}/g;function Xe(t,e){if(t===e)return!0;const r=Object.keys(t),n=Object.keys(e);for(const i of r){if(!n.includes(i))return!1;const a=t[i],c=e[i];if(on(a)&&on(c)){if(!Xe(a,c))return!1}else if(a!==c)return!1}for(const i of n)if(!r.includes(i))return!1;return!0}function on(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ii(t){const e=[];for(const[r,n]of Object.entries(t))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Ms(t,e){const r=new Ls(t,e);return r.subscribe.bind(r)}class Ls{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,n){let i;if(e===void 0&&r===void 0&&n===void 0)throw new Error("Missing Observer.");$s(e,["next","error","complete"])?i=e:i={next:e,error:r,complete:n},i.next===void 0&&(i.next=ur),i.error===void 0&&(i.error=ur),i.complete===void 0&&(i.complete=ur);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function $s(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function ur(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yt(t){return t&&t._delegate?t._delegate:t}class Qe{constructor(e,r,n){this.name=e,this.instanceFactory=r,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oe="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const n=new Ts;if(this.instancesDeferred.set(r,n),this.isInitialized(r)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:r});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const n=this.normalizeInstanceIdentifier(e?.identifier),i=(r=e?.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ws(e))try{this.getOrInitializeService({instanceIdentifier:Oe})}catch{}for(const[r,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(r);try{const a=this.getOrInitializeService({instanceIdentifier:i});n.resolve(a)}catch{}}}}clearInstance(e=Oe){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Oe){return this.instances.has(e)}getOptions(e=Oe){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:r});for(const[a,c]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(a);n===u&&c.resolve(i)}return i}onInit(e,r){var n;const i=this.normalizeInstanceIdentifier(r),a=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;a.add(e),this.onInitCallbacks.set(i,a);const c=this.instances.get(i);return c&&e(c,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,r){const n=this.onInitCallbacks.get(r);if(!!n)for(const i of n)try{i(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:js(e),options:r}),this.instances.set(e,n),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Oe){return this.component?this.component.multipleInstances?e:Oe:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function js(t){return t===Oe?void 0:t}function Ws(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new zs(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var G;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(G||(G={}));const Vs={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},Gs=G.INFO,qs={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},Ks=(t,e,...r)=>{if(e<t.logLevel)return;const n=new Date().toISOString(),i=qs[e];if(i)console[i](`[${n}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class oi{constructor(e){this.name=e,this._logLevel=Gs,this._logHandler=Ks,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in G))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Vs[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...e),this._logHandler(this,G.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...e),this._logHandler(this,G.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,G.INFO,...e),this._logHandler(this,G.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,G.WARN,...e),this._logHandler(this,G.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...e),this._logHandler(this,G.ERROR,...e)}}const Js=(t,e)=>e.some(r=>t instanceof r);let sn,an;function Ys(){return sn||(sn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xs(){return an||(an=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const si=new WeakMap,Ar=new WeakMap,ai=new WeakMap,lr=new WeakMap,zr=new WeakMap;function Qs(t){const e=new Promise((r,n)=>{const i=()=>{t.removeEventListener("success",a),t.removeEventListener("error",c)},a=()=>{r(Te(t.result)),i()},c=()=>{n(t.error),i()};t.addEventListener("success",a),t.addEventListener("error",c)});return e.then(r=>{r instanceof IDBCursor&&si.set(r,t)}).catch(()=>{}),zr.set(e,t),e}function Zs(t){if(Ar.has(t))return;const e=new Promise((r,n)=>{const i=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",c),t.removeEventListener("abort",c)},a=()=>{r(),i()},c=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",a),t.addEventListener("error",c),t.addEventListener("abort",c)});Ar.set(t,e)}let Sr={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return Ar.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ai.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Te(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function ea(t){Sr=t(Sr)}function ta(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const n=t.call(dr(this),e,...r);return ai.set(n,e.sort?e.sort():[e]),Te(n)}:Xs().includes(t)?function(...e){return t.apply(dr(this),e),Te(si.get(this))}:function(...e){return Te(t.apply(dr(this),e))}}function ra(t){return typeof t=="function"?ta(t):(t instanceof IDBTransaction&&Zs(t),Js(t,Ys())?new Proxy(t,Sr):t)}function Te(t){if(t instanceof IDBRequest)return Qs(t);if(lr.has(t))return lr.get(t);const e=ra(t);return e!==t&&(lr.set(t,e),zr.set(e,t)),e}const dr=t=>zr.get(t);function na(t,e,{blocked:r,upgrade:n,blocking:i,terminated:a}={}){const c=indexedDB.open(t,e),u=Te(c);return n&&c.addEventListener("upgradeneeded",h=>{n(Te(c.result),h.oldVersion,h.newVersion,Te(c.transaction),h)}),r&&c.addEventListener("blocked",h=>r(h.oldVersion,h.newVersion,h)),u.then(h=>{a&&h.addEventListener("close",()=>a()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const ia=["get","getKey","getAll","getAllKeys","count"],oa=["put","add","delete","clear"],hr=new Map;function cn(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(hr.get(e))return hr.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,i=oa.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ia.includes(r)))return;const a=async function(c,...u){const h=this.transaction(c,i?"readwrite":"readonly");let f=h.store;return n&&(f=f.index(u.shift())),(await Promise.all([f[r](...u),i&&h.done]))[0]};return hr.set(e,a),a}ea(t=>({...t,get:(e,r,n)=>cn(e,r)||t.get(e,r,n),has:(e,r)=>!!cn(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(aa(r)){const n=r.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(r=>r).join(" ")}}function aa(t){const e=t.getComponent();return e?.type==="VERSION"}const Cr="@firebase/app",un="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _e=new oi("@firebase/app"),ca="@firebase/app-compat",ua="@firebase/analytics-compat",la="@firebase/analytics",da="@firebase/app-check-compat",ha="@firebase/app-check",fa="@firebase/auth",pa="@firebase/auth-compat",ga="@firebase/database",ma="@firebase/data-connect",wa="@firebase/database-compat",ya="@firebase/functions",va="@firebase/functions-compat",Ia="@firebase/installations",ba="@firebase/installations-compat",_a="@firebase/messaging",Ea="@firebase/messaging-compat",Aa="@firebase/performance",Sa="@firebase/performance-compat",Ca="@firebase/remote-config",xa="@firebase/remote-config-compat",Ta="@firebase/storage",ka="@firebase/storage-compat",Da="@firebase/firestore",Ra="@firebase/vertexai",Na="@firebase/firestore-compat",Oa="firebase",Pa="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xr="[DEFAULT]",Ba={[Cr]:"fire-core",[ca]:"fire-core-compat",[la]:"fire-analytics",[ua]:"fire-analytics-compat",[ha]:"fire-app-check",[da]:"fire-app-check-compat",[fa]:"fire-auth",[pa]:"fire-auth-compat",[ga]:"fire-rtdb",[ma]:"fire-data-connect",[wa]:"fire-rtdb-compat",[ya]:"fire-fn",[va]:"fire-fn-compat",[Ia]:"fire-iid",[ba]:"fire-iid-compat",[_a]:"fire-fcm",[Ea]:"fire-fcm-compat",[Aa]:"fire-perf",[Sa]:"fire-perf-compat",[Ca]:"fire-rc",[xa]:"fire-rc-compat",[Ta]:"fire-gcs",[ka]:"fire-gcs-compat",[Da]:"fire-fst",[Na]:"fire-fst-compat",[Ra]:"fire-vertex","fire-js":"fire-js",[Oa]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt=new Map,Ua=new Map,Tr=new Map;function ln(t,e){try{t.container.addComponent(e)}catch(r){_e.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function pt(t){const e=t.name;if(Tr.has(e))return _e.debug(`There were multiple attempts to register component ${e}.`),!1;Tr.set(e,t);for(const r of Nt.values())ln(r,t);for(const r of Ua.values())ln(r,t);return!0}function ci(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function Pe(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fa={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},ke=new wt("app","Firebase",Fa);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,r,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Qe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ke.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jr=Pa;function ui(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const n=Object.assign({name:xr,automaticDataCollectionEnabled:!1},e),i=n.name;if(typeof i!="string"||!i)throw ke.create("bad-app-name",{appName:String(i)});if(r||(r=ni()),!r)throw ke.create("no-options");const a=Nt.get(i);if(a){if(Xe(r,a.options)&&Xe(n,a.config))return a;throw ke.create("duplicate-app",{appName:i})}const c=new Hs(i);for(const h of Tr.values())c.addComponent(h);const u=new Ma(r,n,c);return Nt.set(i,u),u}function La(t=xr){const e=Nt.get(t);if(!e&&t===xr&&ni())return ui();if(!e)throw ke.create("no-app",{appName:t});return e}function Ge(t,e,r){var n;let i=(n=Ba[t])!==null&&n!==void 0?n:t;r&&(i+=`-${r}`);const a=i.match(/\s|\//),c=e.match(/\s|\//);if(a||c){const u=[`Unable to register library "${i}" with version "${e}":`];a&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&c&&u.push("and"),c&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_e.warn(u.join(" "));return}pt(new Qe(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a="firebase-heartbeat-database",za=1,gt="firebase-heartbeat-store";let fr=null;function li(){return fr||(fr=na($a,za,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(gt)}catch(r){console.warn(r)}}}}).catch(t=>{throw ke.create("idb-open",{originalErrorMessage:t.message})})),fr}async function ja(t){try{const r=(await li()).transaction(gt),n=await r.objectStore(gt).get(di(t));return await r.done,n}catch(e){if(e instanceof $e)_e.warn(e.message);else{const r=ke.create("idb-get",{originalErrorMessage:e?.message});_e.warn(r.message)}}}async function dn(t,e){try{const n=(await li()).transaction(gt,"readwrite");await n.objectStore(gt).put(e,di(t)),await n.done}catch(r){if(r instanceof $e)_e.warn(r.message);else{const n=ke.create("idb-set",{originalErrorMessage:r?.message});_e.warn(n.message)}}}function di(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa=1024,Ha=30;class Va{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new qa(r),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,r;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=hn();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(c=>c.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats.length>Ha){const c=Ka(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(c,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){_e.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=hn(),{heartbeatsToSend:n,unsentEntries:i}=Ga(this._heartbeatsCache.heartbeats),a=ei(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=r,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(r){return _e.warn(r),""}}}function hn(){return new Date().toISOString().substring(0,10)}function Ga(t,e=Wa){const r=[];let n=t.slice();for(const i of t){const a=r.find(c=>c.agent===i.agent);if(a){if(a.dates.push(i.date),fn(r)>e){a.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),fn(r)>e){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class qa{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Os()?Ps().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await ja(this.app);return r?.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const i=await this.read();return dn(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const i=await this.read();return dn(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function fn(t){return ei(JSON.stringify({version:2,heartbeats:t})).length}function Ka(t){if(t.length===0)return-1;let e=0,r=t[0].date;for(let n=1;n<t.length;n++)t[n].date<r&&(r=t[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(t){pt(new Qe("platform-logger",e=>new sa(e),"PRIVATE")),pt(new Qe("heartbeat",e=>new Va(e),"PRIVATE")),Ge(Cr,un,t),Ge(Cr,un,"esm2017"),Ge("fire-js","")}Ja("");function hi(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Ya=hi,fi=new wt("auth","Firebase",hi());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ot=new oi("@firebase/auth");function Xa(t,...e){Ot.logLevel<=G.WARN&&Ot.warn(`Auth (${jr}): ${t}`,...e)}function xt(t,...e){Ot.logLevel<=G.ERROR&&Ot.error(`Auth (${jr}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pt(t,...e){throw Wr(t,...e)}function pi(t,...e){return Wr(t,...e)}function gi(t,e,r){const n=Object.assign(Object.assign({},Ya()),{[e]:r});return new wt("auth","Firebase",n).create(e,{appName:t.name})}function ut(t){return gi(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wr(t,...e){if(typeof t!="string"){const r=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t._errorFactory.create(r,...n)}return fi.create(t,...e)}function U(t,e,...r){if(!t)throw Wr(e,...r)}function lt(t){const e="INTERNAL ASSERTION FAILED: "+t;throw xt(e),new Error(e)}function Bt(t,e){t||lt(e)}function Qa(){return pn()==="http:"||pn()==="https:"}function pn(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Za(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Qa()||Rs()||"connection"in navigator)?navigator.onLine:!0}function ec(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,r){this.shortDelay=e,this.longDelay=r,Bt(r>e,"Short delay should be less than long delay!"),this.isMobile=ks()||Ns()}get(){return Za()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(t,e){Bt(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{static initialize(e,r,n){this.fetchImpl=e,r&&(this.headersImpl=r),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;lt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;lt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;lt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ic=new tc(3e4,6e4);function Hr(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function vt(t,e,r,n,i={}){return wi(t,i,async()=>{let a={},c={};n&&(e==="GET"?c=n:a={body:JSON.stringify(n)});const u=ii(Object.assign({key:t.config.apiKey},c)).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f=Object.assign({method:e,headers:h},a);return Ds()||(f.referrerPolicy="no-referrer"),mi.fetch()(yi(t,t.config.apiHost,r,u),f)})}async function wi(t,e,r){t._canInitEmulator=!1;const n=Object.assign(Object.assign({},nc),e);try{const i=new sc(t),a=await Promise.race([r(),i.promise]);i.clearNetworkTimeout();const c=await a.json();if("needConfirmation"in c)throw St(t,"account-exists-with-different-credential",c);if(a.ok&&!("errorMessage"in c))return c;{const u=a.ok?c.errorMessage:c.error.message,[h,f]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw St(t,"credential-already-in-use",c);if(h==="EMAIL_EXISTS")throw St(t,"email-already-in-use",c);if(h==="USER_DISABLED")throw St(t,"user-disabled",c);const p=n[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw gi(t,p,f);Pt(t,p)}}catch(i){if(i instanceof $e)throw i;Pt(t,"network-request-failed",{message:String(i)})}}async function oc(t,e,r,n,i={}){const a=await vt(t,e,r,n,i);return"mfaPendingCredential"in a&&Pt(t,"multi-factor-auth-required",{_serverResponse:a}),a}function yi(t,e,r,n){const i=`${e}${r}?${n}`;return t.config.emulator?rc(t.config,i):`${t.config.apiScheme}://${i}`}class sc{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,n)=>{this.timer=setTimeout(()=>n(pi(this.auth,"network-request-failed")),ic.get())})}}function St(t,e,r){const n={appName:t.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);const i=pi(t,e,n);return i.customData._tokenResponse=r,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ac(t,e){return vt(t,"POST","/v1/accounts:delete",e)}async function vi(t,e){return vt(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dt(t){if(!!t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function cc(t,e=!1){const r=yt(t),n=await r.getIdToken(e),i=Ii(n);U(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,c=a?.sign_in_provider;return{claims:i,token:n,authTime:dt(pr(i.auth_time)),issuedAtTime:dt(pr(i.iat)),expirationTime:dt(pr(i.exp)),signInProvider:c||null,signInSecondFactor:a?.sign_in_second_factor||null}}function pr(t){return Number(t)*1e3}function Ii(t){const[e,r,n]=t.split(".");if(e===void 0||r===void 0||n===void 0)return xt("JWT malformed, contained fewer than 3 sections"),null;try{const i=ti(r);return i?JSON.parse(i):(xt("Failed to decode base64 JWT payload"),null)}catch(i){return xt("Caught error parsing JWT payload as JSON",i?.toString()),null}}function gn(t){const e=Ii(t);return U(e,"internal-error"),U(typeof e.exp<"u","internal-error"),U(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kr(t,e,r=!1){if(r)return e;try{return await e}catch(n){throw n instanceof $e&&uc(n)&&t.auth.currentUser===t&&await t.auth.signOut(),n}}function uc({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=dt(this.lastLoginAt),this.creationTime=dt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ut(t){var e;const r=t.auth,n=await t.getIdToken(),i=await kr(t,vi(r,{idToken:n}));U(i?.users.length,r,"internal-error");const a=i.users[0];t._notifyReloadListener(a);const c=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?bi(a.providerUserInfo):[],u=hc(t.providerData,c),h=t.isAnonymous,f=!(t.email&&a.passwordHash)&&!u?.length,p=h?f:!1,m={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new Dr(a.createdAt,a.lastLoginAt),isAnonymous:p};Object.assign(t,m)}async function dc(t){const e=yt(t);await Ut(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function hc(t,e){return[...t.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function bi(t){return t.map(e=>{var{providerId:r}=e,n=Rn(e,["providerId"]);return{providerId:r,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fc(t,e){const r=await wi(t,{},async()=>{const n=ii({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:a}=t.config,c=yi(t,i,"/v1/token",`key=${a}`),u=await t._getAdditionalHeaders();return u["Content-Type"]="application/x-www-form-urlencoded",mi.fetch()(c,{method:"POST",headers:u,body:n})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function pc(t,e){return vt(t,"POST","/v2/accounts:revokeToken",Hr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U(typeof e.idToken<"u","internal-error"),U(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):gn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){U(e.length!==0,"internal-error");const r=gn(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(U(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:n,refreshToken:i,expiresIn:a}=await fc(e,r);this.updateTokensAndExpiration(n,i,Number(a))}updateTokensAndExpiration(e,r,n){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,r){const{refreshToken:n,accessToken:i,expirationTime:a}=r,c=new qe;return n&&(U(typeof n=="string","internal-error",{appName:e}),c.refreshToken=n),i&&(U(typeof i=="string","internal-error",{appName:e}),c.accessToken=i),a&&(U(typeof a=="number","internal-error",{appName:e}),c.expirationTime=a),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new qe,this.toJSON())}_performRefresh(){return lt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ce(t,e){U(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class be{constructor(e){var{uid:r,auth:n,stsTokenManager:i}=e,a=Rn(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new lc(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Dr(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const r=await kr(this,this.stsTokenManager.getToken(this.auth,e));return U(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return cc(this,e)}reload(){return dc(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new be(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),r&&await Ut(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Pe(this.auth.app))return Promise.reject(ut(this.auth));const e=await this.getIdToken();return await kr(this,ac(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var n,i,a,c,u,h,f,p;const m=(n=r.displayName)!==null&&n!==void 0?n:void 0,v=(i=r.email)!==null&&i!==void 0?i:void 0,E=(a=r.phoneNumber)!==null&&a!==void 0?a:void 0,C=(c=r.photoURL)!==null&&c!==void 0?c:void 0,D=(u=r.tenantId)!==null&&u!==void 0?u:void 0,T=(h=r._redirectEventId)!==null&&h!==void 0?h:void 0,L=(f=r.createdAt)!==null&&f!==void 0?f:void 0,$=(p=r.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:W,emailVerified:A,isAnonymous:S,providerData:_,stsTokenManager:b}=r;U(W&&b,e,"internal-error");const I=qe.fromJSON(this.name,b);U(typeof W=="string",e,"internal-error"),Ce(m,e.name),Ce(v,e.name),U(typeof A=="boolean",e,"internal-error"),U(typeof S=="boolean",e,"internal-error"),Ce(E,e.name),Ce(C,e.name),Ce(D,e.name),Ce(T,e.name),Ce(L,e.name),Ce($,e.name);const x=new be({uid:W,auth:e,email:v,emailVerified:A,displayName:m,isAnonymous:S,photoURL:C,phoneNumber:E,tenantId:D,stsTokenManager:I,createdAt:L,lastLoginAt:$});return _&&Array.isArray(_)&&(x.providerData=_.map(N=>Object.assign({},N))),T&&(x._redirectEventId=T),x}static async _fromIdTokenResponse(e,r,n=!1){const i=new qe;i.updateFromServerResponse(r);const a=new be({uid:r.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Ut(a),a}static async _fromGetAccountInfoResponse(e,r,n){const i=r.users[0];U(i.localId!==void 0,"internal-error");const a=i.providerUserInfo!==void 0?bi(i.providerUserInfo):[],c=!(i.email&&i.passwordHash)&&!a?.length,u=new qe;u.updateFromIdToken(n);const h=new be({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:c}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Dr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!a?.length};return Object.assign(h,f),h}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mn=new Map;function Fe(t){Bt(t instanceof Function,"Expected a class definition");let e=mn.get(t);return e?(Bt(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,mn.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}_i.type="NONE";const wn=_i;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gr(t,e,r){return`firebase:${t}:${e}:${r}`}class Ke{constructor(e,r,n){this.persistence=e,this.auth=r,this.userKey=n;const{config:i,name:a}=this.auth;this.fullUserKey=gr(this.userKey,i.apiKey,a),this.fullPersistenceKey=gr("persistence",i.apiKey,a),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?be._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,n="authUser"){if(!r.length)return new Ke(Fe(wn),e,n);const i=(await Promise.all(r.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let a=i[0]||Fe(wn);const c=gr(n,e.config.apiKey,e.name);let u=null;for(const f of r)try{const p=await f._get(c);if(p){const m=be._fromJSON(e,p);f!==a&&(u=m),a=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!a._shouldAllowMigration||!h.length?new Ke(a,e,n):(a=h[0],u&&await a._set(c,u.toJSON()),await Promise.all(r.map(async f=>{if(f!==a)try{await f._remove(c)}catch{}})),new Ke(a,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yc(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(gc(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ic(e))return"Blackberry";if(bc(e))return"Webos";if(mc(e))return"Safari";if((e.includes("chrome/")||wc(e))&&!e.includes("edge/"))return"Chrome";if(vc(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(r);if(n?.length===2)return n[1]}return"Other"}function gc(t=we()){return/firefox\//i.test(t)}function mc(t=we()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function wc(t=we()){return/crios\//i.test(t)}function yc(t=we()){return/iemobile/i.test(t)}function vc(t=we()){return/android/i.test(t)}function Ic(t=we()){return/blackberry/i.test(t)}function bc(t=we()){return/webos/i.test(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ei(t,e=[]){let r;switch(t){case"Browser":r=yn(we());break;case"Worker":r=`${yn(we())}-${t}`;break;default:r=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${jr}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const n=a=>new Promise((c,u)=>{try{const h=e(a);c(h)}catch(h){u(h)}});n.onAbort=r,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const n of this.queue)await n(e),n.onAbort&&r.push(n.onAbort)}catch(n){r.reverse();for(const i of r)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ec(t,e={}){return vt(t,"GET","/v2/passwordPolicy",Hr(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ac=6;class Sc{constructor(e){var r,n,i,a;const c=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=c.minPasswordLength)!==null&&r!==void 0?r:Ac,c.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=c.maxPasswordLength),c.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=c.containsLowercaseCharacter),c.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=c.containsUppercaseCharacter),c.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=c.containsNumericCharacter),c.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=c.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,n,i,a,c,u;const h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(r=h.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(n=h.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(a=h.containsUppercaseLetter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(c=h.containsNumericCharacter)!==null&&c!==void 0?c:!0),h.isValid&&(h.isValid=(u=h.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),h}validatePasswordLengthOptions(e,r){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(r.meetsMinPasswordLength=e.length>=n),i&&(r.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(r,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,r,n,i,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(e,r,n,i){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new vn(this),this.idTokenSubscription=new vn(this),this.beforeStateQueue=new _c(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=fi,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=Fe(r)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Ke.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await vi(this,{idToken:e}),n=await be._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(n)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(Pe(this.app)){const c=this.app.settings.authIdToken;return c?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(c).then(u,u))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const c=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,u=i?._redirectEventId,h=await this.tryRedirectSignIn(e);(!c||c===u)&&h?.user&&(i=h.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(c){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(c))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return U(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await Ut(e)}catch(r){if(r?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ec()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Pe(this.app))return Promise.reject(ut(this));const r=e?yt(e):null;return r&&U(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Pe(this.app)?Promise.reject(ut(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Pe(this.app)?Promise.reject(ut(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Fe(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Ec(this),r=new Sc(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new wt("auth","Firebase",e())}onAuthStateChanged(e,r,n){return this.registerStateListener(this.authStateSubscription,e,r,n)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,n){return this.registerStateListener(this.idTokenSubscription,e,r,n)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(n.tenantId=this.tenantId),await pc(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const n=await this.getOrInitRedirectPersistenceManager(r);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&Fe(e)||this._popupRedirectResolver;U(r,this,"argument-error"),this.redirectPersistenceManager=await Ke.create(this,[Fe(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,n;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,n,i){if(this._deleted)return()=>{};const a=typeof r=="function"?r:r.next.bind(r);let c=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(U(u,this,"internal-error"),u.then(()=>{c||a(this.currentUser)}),typeof r=="function"){const h=e.addObserver(r,n,i);return()=>{c=!0,h()}}else{const h=e.addObserver(r);return()=>{c=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ei(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(r["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(r["X-Firebase-AppCheck"]=i),r}async _getAppCheckToken(){var e;if(Pe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r?.error&&Xa(`Error while retrieving App Check token: ${r.error}`),r?.token}}function Vr(t){return yt(t)}class vn{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ms(r=>this.observer=r)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xc(t,e){const r=ci(t,"auth");if(r.isInitialized()){const i=r.getImmediate(),a=r.getOptions();if(Xe(a,e??{}))return i;Pt(i,"already-initialized")}return r.initialize({options:e})}function Tc(t,e){const r=e?.persistence||[],n=(Array.isArray(r)?r:[r]).map(Fe);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(n,e?.popupRedirectResolver)}function kc(t,e,r){const n=Vr(t);U(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!!r?.disableWarnings,a=Ai(e),{host:c,port:u}=Dc(e),h=u===null?"":`:${u}`,f={url:`${a}//${c}${h}/`},p=Object.freeze({host:c,port:u,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){U(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),U(Xe(f,n.config.emulator)&&Xe(p,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=f,n.emulatorConfig=p,n.settings.appVerificationDisabledForTesting=!0,i||Rc()}function Ai(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Dc(t){const e=Ai(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const a=i[1];return{host:a,port:In(n.substr(a.length+1))}}else{const[a,c]=n.split(":");return{host:a,port:In(c)}}}function In(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Rc(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,n,i=!1){const a=await be._fromIdTokenResponse(e,n,i),c=bn(n);return new Ft({user:a,providerId:c,_tokenResponse:n,operationType:r})}static async _forOperation(e,r,n){await e._updateTokensIfNecessary(n,!0);const i=bn(n);return new Ft({user:e,providerId:i,_tokenResponse:n,operationType:r})}}function bn(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nc(t,e){return oc(t,"POST","/v1/accounts:signInWithCustomToken",Hr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oc(t,e){if(Pe(t.app))return Promise.reject(ut(t));const r=Vr(t),n=await Nc(r,{token:e,returnSecureToken:!0}),i=await Ft._fromIdTokenResponse(r,"signIn",n);return await r._updateCurrentUser(i.user),i}function Pc(t,e,r,n){return yt(t).onAuthStateChanged(e,r,n)}const _n="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(i=>i.isListeningto(e));if(r)return r;const n=new qt(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:n,eventType:i,data:a}=r.data,c=this.handlersMap[i];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const u=Array.from(c).map(async f=>f(r.origin,a)),h=await Bc(u);r.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:h})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}qt.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uc(t="",e=10){let r="";for(let n=0;n<e;n++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,c;return new Promise((u,h)=>{const f=Uc("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},n);c={messageChannel:i,onMessage(m){const v=m;if(v.data.eventId===f)switch(v.data.status){case"ack":clearTimeout(p),a=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),u(v.data.response);break;default:clearTimeout(p),clearTimeout(a),h(new Error("invalid_response"));break}}},this.handlers.add(c),i.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:f,data:r},[i.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(){return window}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Si(){return typeof En().WorkerGlobalScope<"u"&&typeof En().importScripts=="function"}async function Mc(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Lc(){var t;return((t=navigator?.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function $c(){return Si()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ci="firebaseLocalStorageDb",zc=1,Mt="firebaseLocalStorage",xi="fbase_key";class It{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function Kt(t,e){return t.transaction([Mt],e?"readwrite":"readonly").objectStore(Mt)}function jc(){const t=indexedDB.deleteDatabase(Ci);return new It(t).toPromise()}function Rr(){const t=indexedDB.open(Ci,zc);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const n=t.result;try{n.createObjectStore(Mt,{keyPath:xi})}catch(i){r(i)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(Mt)?e(n):(n.close(),await jc(),e(await Rr()))})})}async function An(t,e,r){const n=Kt(t,!0).put({[xi]:e,value:r});return new It(n).toPromise()}async function Wc(t,e){const r=Kt(t,!1).get(e),n=await new It(r).toPromise();return n===void 0?null:n.value}function Sn(t,e){const r=Kt(t,!0).delete(e);return new It(r).toPromise()}const Hc=800,Vc=3;class Ti{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Rr(),this.db)}async _withRetries(e){let r=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(r++>Vc)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Si()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qt._getInstance($c()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await Mc(),!this.activeServiceWorker)return;this.sender=new Fc(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);!n||((e=n[0])===null||e===void 0?void 0:e.fulfilled)&&((r=n[0])===null||r===void 0?void 0:r.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Lc()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Rr();return await An(e,_n,"1"),await Sn(e,_n),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(n=>An(n,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(n=>Wc(n,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>Sn(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const a=Kt(i,!1).getAll();return new It(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:a}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),r.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),r.push(i));return r}notifyListeners(e,r){this.localCache[e]=r;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Hc)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ti.type="LOCAL";const Gc=Ti;var Cn="@firebase/auth",xn="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);!r||(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kc(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Jc(t){pt(new Qe("auth",(e,{options:r})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:c,authDomain:u}=n.options;U(c&&!c.includes(":"),"invalid-api-key",{appName:n.name});const h={apiKey:c,authDomain:u,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ei(t)},f=new Cc(n,i,a,h);return Tc(f,r),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,n)=>{e.getProvider("auth-internal").initialize()})),pt(new Qe("auth-internal",e=>{const r=Vr(e.getProvider("auth").getImmediate());return(n=>new qc(n))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ge(Cn,xn,Kc(t)),Ge(Cn,xn,"esm2017")}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ze(t=La()){const e=ci(t,"auth");if(e.isInitialized())return e.getImmediate();const r=xc(t,{persistence:[Gc]}),n=xs("auth");return n&&kc(r,`http://${n}`),r}Jc("WebExtension");var Yc="firebase",Xc="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ge(Yc,Xc,"app");const Qc={}.STAGING?{projectId:"dev-storytodesign",storageBucket:"dev-storytodesign.appspot.com",apiKey:"AIzaSyBWv_ip8ye3EEmzT1cZ1sqhV1rSoA9LS48",authDomain:"dev-storytodesign.firebaseapp.com",messagingSenderId:"568452031036"}:{apiKey:"AIzaSyAYhTW2QNjar9gR2wslR0V6Yugfh7xia8c",authDomain:"prd-storytodesign.firebaseapp.com",messagingSenderId:"394848236605",projectId:"prd-storytodesign",storageBucket:"prd-storytodesign.appspot.com"},Nr={api:"https://h.to.design",concurrent:"https://hc.to.design"},ki={[Nr.api]:"https://h2d.divriots.com",[Nr.concurrent]:"https://h2d.divriots.com"},Di=!{}.STAGING,Zc=!Di&&{}.STAGING,Tn=Di?Nr:Zc?{api:"https://us-central1-dev-storytodesign.cloudfunctions.net/api2",concurrent:"https://us-central1-dev-storytodesign.cloudfunctions.net/apiConcurrent"}:{api:"http://localhost:5101/dev-storytodesign/us-central1/api2",concurrent:"http://localhost:5101/dev-storytodesign/us-central1/apiConcurrent"},Ri=t=>(t==="/html"||t==="/page"||t==="/make"?Tn.api:Tn.concurrent)+t,et=ui(Qc);async function eu(t,e){const{id:r,url:n}=await Ni(t,"/import-upload-initiate",{body:JSON.stringify({size:e})});return{id:r,url:n}}const kn={fallbacks:{"storage.googleapis.com":"s2dgs.divriots.com"},retry:[401]};async function Ni(t,e,r){const n=await Rt(Ri(e),{headers:{Authorization:`Bearer ${await t.getIdToken()}`,"Content-Type":"application/json"},method:"POST",fallbacks:ki,retry:!0,...r});if(!n.ok)throw new Error("Request failed",{cause:{endpoint:e,status:n.status}});return n.json()}async function tu(t,e,r,n="application/octet-stream",i){const a={Authorization:await t.getIdToken(),"Content-Type":n};i&&(a["Content-Disposition"]=i);const c=await Rt(e,{method:"PUT",headers:a,body:r,...kn});if(!c.ok)throw new Error(`Request failed with status ${c.status}`);(i||n!=="application/octet-stream")&&await Rt(e,{method:"PATCH",headers:{...a,"Content-Type":"application/json"},...kn,body:JSON.stringify({contentDisposition:i,contentType:n})})}async function ru(t,e,r){return Ni(t,"/import-upload-finalize",{body:JSON.stringify({id:e,name:r.url,importType:r.full?"full":"selection",screenshot:r.screenshot?`data:image/webp;base64,${r.screenshot}`:void 0,options:r.full?r.tasks.map(({width:n,theme:i})=>({width:n,theme:i})):void 0,react:!1})})}const nu={}.STAGING?"LDf490o7aCqZCHTNUw0XV6":"oyWeZoCexh5JS6mSVM8Gtu";async function iu(){const t="current_user:read",e=chrome.identity.getRedirectURL("provider_cb"),r={interactive:!0,url:`https://www.figma.com/oauth?client_id=${nu}&redirect_uri=${e}&scope=${t}&state=secure_random_string&response_type=code`},n=await chrome.identity.launchWebAuthFlow(r).catch(h=>{throw K.exception("firebaseFigmaOAuth:launchWebAuthFlow",h),h});if(!n)throw K.exception("userLogin:launchWebAuthFlow",chrome.runtime.lastError||new Error("No details")),new Error("An error occurred while authenticating with Figma");const i=new URL(n).searchParams.get("code"),a=await Rt(Ri("/membership"),{method:"POST",fallbacks:ki,headers:{Authorization:`Figma-ext-oauth ${i}`}});if(!a.ok)throw K.exception("userLogin:membership",await a.text().catch(()=>new Error(""))),new Error("An error occurred while authenticating with our servers");const c=await a.json(),{firebaseToken:u}=c;try{await Oc(Ze(et),u)}catch(h){throw K.exception("userLogin:signInWithCustomToken",h),new Error("An error occurred while authenticating with Firebase")}}ws("chr-ext");chrome.runtime.onInstalled.addListener(()=>console.debug("Extension installed"));console.debug("Service worker starting");let ee,Or;const Le=[],Me=async(t,e)=>Ye("clearCapture",async()=>{const r=ee,n=[],i=Le.filter(a=>e.status!=="importing"||!a.terminal?(n.push(a),!1):!0);if(Le.length=0,Le.push(...i),r?.full&&e.status!=="importing"){const a=r.tasks[r.currentIdx];a.theme!=="default"&&n.unshift({name:"reset setEmulatedMedia",action:()=>chrome.debugger.sendCommand(t,"Emulation.setEmulatedMedia",{features:[]})}),a.width&&n.unshift({name:"clearDeviceMetricsOverride",action:()=>chrome.debugger.sendCommand(t,"Emulation.clearDeviceMetricsOverride")})}for(const{name:a,action:c}of n)try{console.log(`Cleaning up ${a}`),await c()}catch(u){console.error(`Cleanup of ${a} failed`,u)}e.status!=="importing"&&lu(e)}),{promise:Oi,resolve:ou}=Br();async function Lt(){await Oi;const t=Ze(et).currentUser;await ae("updateUserStatus",{logged:!!t,email:t?.email||void 0,name:t?.displayName||void 0,loggingIn:Pr},"popup")}const su=chrome.storage.sync.get("generatedUserId").then(t=>{if(t.generatedUserId)return t.generatedUserId;const e=`temp-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;return chrome.storage.sync.set({generatedUserId:e}),e}).catch(t=>{K.exception("generatedUserId",t)});Pc(Ze(et),async t=>{K.addDefault({userid:t?.uid||await su}),ou(),Lt().catch(e=>console.info("user status not sent, popup is probably not open",e))});async function au(){const n=chrome.runtime.getURL(rn[38]),i=await fetch(n).then(async a=>{const c=await a.blob(),u=await createImageBitmap(c),f=new OffscreenCanvas(38,38).getContext("2d"),p=Date.now(),m=setInterval(function(){const v=(Date.now()-p)/1e3*16/16;f.save(),f.clearRect(0,0,38,38),f.globalAlpha=.3,f.drawImage(u,0,0),f.globalAlpha=1,f.translate(38/2,38/2),f.rotate(Math.PI*2*v);for(let C=0;C<16;C++)f.beginPath(),f.rotate(Math.PI*2/16),f.moveTo(38/10,0),f.lineTo(38/2,0),f.lineWidth=38/30,f.strokeStyle="rgba(0, 0, 0,"+C/16+")",f.stroke();const E=f.getImageData(0,0,38,38);chrome.action.setIcon({imageData:E}),f.restore()},100);return()=>{clearInterval(m),chrome.action.setIcon({path:rn})}});Le.push({name:"loading icon",terminal:!0,action:i})}let Tt=!1,Je;const ht=async()=>{console.info("received cancelCapture"),Tt=!0,Je&&(await ae("cancelCapture",void 0,me(Je)).catch(t=>console.error("Error when trying to cancel capture",t)),await Me(Je,{status:"cancelled"}))};re("cancelCapture",ht);chrome.debugger.onDetach.addListener(ht);const cu=async()=>{if(console.info("received stopScrolling"),!Je)return;const t=me(Je);await ae("stopScrolling",void 0,t).catch(e=>{console.error("Error when trying to stop scrolling",e)})};re("stopScrolling",cu);const Pi=async(t,e)=>{if(!t)throw new Error("No target available");Tt=!1;const{url:r="<NOURL>",...n}=t;Je=n,au(),Dn({...e.full?{full:!0,tasks:e.tasks,currentIdx:0}:{full:!1},saveLocation:e.saveLocation,serializedFrames:[],assetsCache:{},target:n,url:r});const i={url:r},a={...K.def,properties:{...K.def?.properties,...i}};try{K.addDefault(a);const c=await chrome.webNavigation.getAllFrames({tabId:n.tabId});if(await chrome.scripting.executeScript({target:n,world:"MAIN",func:function(){try{window.AOS?.init&&(console.log("Disabling AOS for snapshot"),window.AOS.init({once:!0,duration:0}))}catch(p){console.error("Failed to disable AOS",p)}try{let p=window.ScrollSmoother;if(p?.get&&(p=p.get()),p){console.log("Disabling GSAP ScrollSmoother");const m=p.wrapper();p.kill(),m&&(m.style.opacity="1",m.style.overflow="visible",m.style.position="static")}}catch(p){console.error("Failed to disable GSAP ScrollSmoother",p)}}}),await Ye("cleanup dom for attach",async()=>(await Promise.all((c||[]).map(async m=>{try{return!(await chrome.scripting.executeScript({target:{tabId:n.tabId,frameIds:[m.frameId]},files:["assets/src/contentScript/cleanupDomForAttach.js"]}))[0].result}catch(v){return console.warn(v),!1}}))).some(Boolean)))return Me(n,{status:"cancelled"});const{contentScriptId:h}=await Ye("inject main content script",()=>Kn(n,a));Le.push({name:"cleanup content script",action:()=>ae("cleanup",void 0,me(n)),terminal:!0}),Le.push(await uu(n,c||[]));const f=async p=>{await du(n,h,a,p),console.debug("Running content script"),await ae(e.full?"removeSelector":"addSelector",void 0,me(n))};if(e.full){let p=0;K.track("capture",{properties:{type:"full",saveLocation:e.saveLocation,tasks:e.tasks.map(m=>JSON.stringify(m))}});for(const m of e.tasks){if(Tt)return;Dn({...ee,full:!0,tasks:e.tasks,currentIdx:p++}),await f(m),await ae("convertBody",m,me(n)),await Me(n,{status:"importing"})}await Fi()}else K.track("capture",{properties:{type:"selection",saveLocation:e.saveLocation}}),await f()}catch(c){if(Tt)return await Me(n,{status:"cancelled"});K.track("capture-error",{properties:{full:ee?.full,type:c.name},error:c});const u=c.message==="The extensions gallery cannot be scripted."?"Chrome Webstore pages can't be captured.<br/>Please try with another web page":c.message;throw await Me(n,{status:"errored",message:u}),c}finally{K.addDefault({properties:Object.fromEntries(Object.keys(i).map(c=>[c,void 0]))})}};async function uu(t,e){const r={...t,frameIds:e.map(n=>n.frameId)};return await chrome.scripting.executeScript({target:r,world:"MAIN",func:function(){if(!document.getElementById("notion-app"))return;const n=MutationObserver.prototype;n.__observeBackup=n.observe,n.__disconnectBackup=n.disconnect;const i=n.__observeQueue=[];n.observe=function(...a){n.__disconnectBackup.call(this),i.push({obs:this,args:a})},n.disconnect=function(){const a=i.findIndex(c=>c.obs===this);a>=0&&i.splice(a,1)}}}).catch(n=>{console.warn("Failed to disable MutationObserver.observe()",n)}),{name:"restore disabled mutation observer",action:()=>{chrome.scripting.executeScript({target:r,world:"MAIN",func:function(){const n=MutationObserver.prototype;n.__observeBackup&&(n.observe=n.__observeBackup),n.__disconnectBackup&&(n.disconnect=n.__disconnectBackup);for(const{obs:i,args:a}of n.__observeQueue||[])i.observe(...a)}}).catch(n=>{console.warn("Failed to restore MutationObserver.observe()",n)})}}}function lu(t){ee=void 0,ae("updateCurrentTask",{state:t},"popup").catch(()=>{Or=t})}function Dn(t){ee=t,ae("updateCurrentTask",{task:Bi()},"popup").catch(()=>{})}const Bi=()=>{if(!ee)return;const{serializedFrames:t,assetsCache:e,target:r,...n}=ee;return n};re("getCurrentTask",()=>{Ui(),Lt();const t={task:Bi(),state:Or};return Or=void 0,t});re("finalizeImport",Fi);function Ui(){Oi.then(()=>K.track("run"))}async function Fi(){if(!ee)throw new Error("No task is in progress");const t=ee;await Gt();try{const[e,...r]=t.serializedFrames||[];for(const{fonts:a,assets:c,...u}of r||[]){Object.assign(e.assets,c);for(const h of a)e.fonts.find(gs(h))||e.fonts.push(h);(e.alternatives??=[]).push(u)}if(t.full){const a=t.serializedFrames.filter(c=>!c.width);if(a.length){const c=a[0].doc.innerWidth;a.forEach(u=>u.width=c),t.tasks.filter(u=>!u.width).forEach(u=>u.width=c)}}const n=Vn(new TextEncoder().encode(JSON.stringify(e))).map(a=>a^1337);let i=!1;if(t.saveLocation==="gstorage"){let a=Ze(et).currentUser;if(!a){if(!await mr("Login required","Please log in with your Figma account to send your capture to the html.to.design Figma plugin.","Log in"))return ht();if(a=await Mi().then(()=>Ze(et).currentUser),a)K.exception("finalizeImport:gstorageUpload",new Error,{reason:"was not logged"});else if(K.exception("finalizeImport:gstorageUpload",new Error,{reason:"login failed"}),!await mr("Login failed","Unable to connect to your account, please check your network connectivity. Do you want to save the h2d file as a fallback?","Save h2d file"))return ht()}if(a)try{const{id:c,url:u}=await eu(a,n.length).catch(h=>{throw new Error("initiate failed",{cause:h})});await tu(a,u,n).catch(h=>{throw new Error("upload failed",{cause:h})}),await ru(a,c,t).catch(h=>{throw new Error("finalize failed",{cause:h})}),i=!0}catch(c){if(K.exception("finalizeImport:gstorageUpload",c.cause||c,{reason:c.message}),!await mr("Upload failed","Unable to send your captured site to the plugin, please check your network connectivity. Do you want to save the h2d file as a fallback?","Save h2d file"))return ht()}}if(!i){const a=await new Promise(p=>{const m=new FileReader;m.onload=()=>p(m.result),m.readAsDataURL(new Blob([n]))});let c=ms(t.url);if(t.full){for(const p of new Set(t.tasks.map(m=>m.width||"v")))c+=`_${p}w`;for(const p of new Set(t.tasks.map(m=>m.theme)))c+=`_${p}`}c+=".h2d";const{promise:u,resolve:h}=Br(),f=(p,m)=>{p.byExtensionName==="html.to.design"&&(m({filename:c}),h())};chrome.downloads.onDeterminingFilename.addListener(f),await chrome.downloads.download({filename:c,url:a}),await Promise.race([mt(3e3,{errorOnTimeout:"timed out"}),u.then(()=>Ye)]).catch(()=>console.error("Download listener was not called within allocated timeout")),chrome.downloads.onDeterminingFilename.removeListener(f)}}catch(e){throw new Error("Import finalization failed",{cause:e})}await Me(t.target,{status:"done"})}async function du(t,e,r,n){await ls(t,Le,e,r,{beforeDomSnapshot:async i=>{if(n?.width){const a=await i.send("Page.getLayoutMetrics").then(c=>c.cssVisualViewport.zoom||1).catch(()=>1);await i.send("Emulation.setDeviceMetricsOverride",{width:Math.round(n.width*a),height:Math.round(ao(n.width)*a),deviceScaleFactor:0,mobile:!1})}n&&n.theme!=="default"&&await i.send("Emulation.setEmulatedMedia",{features:[{name:"prefers-color-scheme",value:n.theme}]})}})}async function $t(t,e){return ae("toastError",e.message||String(e),me(t)).catch(()=>{})}const mr=async(t,e,r="OK")=>await Gn("confirm",{title:t,message:e,okLabel:r});re("startCapture",async({data:{target:t,opts:e}})=>{await Pi(t,e).catch(r=>$t(t,r))});let Pr=!1;const Mi=async t=>{Pr=!0,Lt();let e;(function r(){e=setTimeout(async()=>{await Gt(),e!==void 0&&r()},100)})();try{if(await iu().finally(()=>{Pr=!1,Lt()}),t){const r=(await chrome.storage.local.get(["settings"])).settings;await chrome.storage.local.set({settings:{...r,saveLocation:"gstorage"}}),await ae("reloadUserSettings",void 0,"popup")}}finally{clearTimeout(e),e=void 0}};re("userLogin",({data:t})=>Mi(t?.setSaveLocation));re("userLogout",()=>Ze(et).signOut());re("importFailed",async({data:t})=>{!ee||(await $t(ee.target,t),await Me(ee.target,{status:"errored"}))});chrome.commands.onCommand.addListener(async t=>{Ui();const e=await oo();if(ee){$t(e,"An import is already in progress");return}const r={full:t==="capture-full"},n=(await chrome.storage.local.get(["settings"])).settings;if(r.full){const i=n||{devices:[qr],multiImport:{modes:["default"],deviceIds:[qr.id]}};r.saveLocation=i.saveLocation||"file",r.tasks=so(i)}Gt(),await Pi(e,r).catch(i=>$t(e,i))});re("openShortcuts",()=>{const t=navigator.userAgent.toLowerCase(),e=["edge","brave","vivaldi","arc","opera","epic","yandex"].find(r=>t.includes(r))||"chrome";chrome.tabs.create({url:`${e}://extensions/shortcuts`})});
